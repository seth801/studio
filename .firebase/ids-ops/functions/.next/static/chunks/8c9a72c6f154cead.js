(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57960,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=k[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function v(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function E(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function _(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,A(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,A(x(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return A(x(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function C(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var k=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,33015,65233,68483,44435,85086,17875,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,p,g,m,y,v,w,b=e.i(47167),E=e.i(57960);let I=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},_=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},T={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(I(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):_(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new S;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class S extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let x=function(e){let t=I(e);return T.encodeByteArray(t,!0)},C=function(e){return x(e).replace(/\./g,"")},A=function(e){try{return T.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function D(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g}let k=()=>{try{return D().__FIREBASE_DEFAULTS__||(()=>{if(void 0===b.default||void 0===b.default.env)return;let e=b.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&A(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},N=e=>{var t,r;return null==(r=null==(t=k())?void 0:t.emulatorHosts)?void 0:r[e]},R=e=>{let t=N(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},O=()=>{var e;return null==(e=k())?void 0:e.config},M=e=>{var t;return null==(t=k())?void 0:t[`_${e}`]};class L{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function P(e){return e.endsWith(".cloudworkstations.dev")}async function F(e){return(await fetch(e,{credentials:"include"})).ok}function V(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[C(JSON.stringify({alg:"none",type:"JWT"})),C(JSON.stringify(s)),""].join(".")}let B={},U=!1;function q(e,t){if("undefined"==typeof window||"undefined"==typeof document||!P(window.location.host)||B[e]===t||B[e]||U)return;function r(e){return`__firebase__banner__${e}`}B[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(B))B[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;U=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function z(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function j(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(z())}function $(){var t;let r=null==(t=k())?void 0:t.forceEnvironment;if("node"===r)return!0;if("browser"===r)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function K(){return"undefined"!=typeof window||G()}function G(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Q(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function H(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function W(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function X(){let e=z();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Y(){return!$()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function J(){return!$()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Z(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ee(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}function et(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}class er extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,er.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,en.prototype.create)}}class en{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(ei,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new er(s,l,i)}}let ei=/\{\$([^}]+)}/g;function es(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ea(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(eo(r)&&eo(s)){if(!ea(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function eo(e){return null!==e&&"object"==typeof e}function el(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eu(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function eh(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function ec(e,t){let r=new ed(e,t);return r.subscribe.bind(r)}class ed{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=ef),void 0===n.error&&(n.error=ef),void 0===n.complete&&(n.complete=ef);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ef(){}function ep(e,t=1e3,r=2){let n=t*Math.pow(r,e),i=Math.round(.5*n*(Math.random()-.5)*2);return Math.min(144e5,n+i)}function eg(e){return e&&e._delegate?e._delegate:e}e.s(["Deferred",()=>L,"ErrorFactory",()=>en,"FirebaseError",()=>er,"areCookiesEnabled",()=>et,"base64Decode",()=>A,"base64urlEncodeWithoutPadding",()=>C,"calculateBackoffMillis",()=>ep,"createMockUserToken",()=>V,"createSubscribe",()=>ec,"deepEqual",()=>ea,"extractQuerystring",()=>eh,"getDefaultAppConfig",()=>O,"getDefaultEmulatorHost",()=>N,"getDefaultEmulatorHostnameAndPort",()=>R,"getExperimentalSetting",()=>M,"getGlobal",()=>D,"getModularInstance",()=>eg,"getUA",()=>z,"isBrowser",()=>K,"isBrowserExtension",()=>H,"isCloudWorkstation",()=>P,"isCloudflareWorker",()=>Q,"isEmpty",()=>es,"isIE",()=>X,"isIndexedDBAvailable",()=>Z,"isMobileCordova",()=>j,"isReactNative",()=>W,"isSafari",()=>Y,"isSafariOrWebkit",()=>J,"isWebWorker",()=>G,"pingServer",()=>F,"querystring",()=>el,"querystringDecode",()=>eu,"updateEmulatorBanner",()=>q,"validateIndexedDBOpenable",()=>ee],33015);class em{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ey="[DEFAULT]";class ev{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new L;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ey})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ey){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ey){return this.instances.has(e)}getOptions(e=ey){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!=(r=this.onInitCallbacks.get(n))?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ey?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=ey){return this.component?this.component.multipleInstances?e:ey:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ew{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ev(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>em,"ComponentContainer",()=>ew],65233);let eb=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eE={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},eI=s.INFO,e_={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eT=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=e_[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eS{constructor(e){this.name=e,this._logLevel=eI,this._logHandler=eT,this._userLogHandler=null,eb.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eE[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}function ex(e){eb.forEach(t=>{t.setLogLevel(e)})}function eC(e,t){for(let r of eb){let n=null;t&&t.level&&(n=eE[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let a=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(null!=n?n:t.logLevel)&&e({level:s[r].toLowerCase(),message:a,args:i,type:t.name})}}}e.s(["LogLevel",()=>s,"Logger",()=>eS,"setLogLevel",()=>ex,"setUserLogHandler",()=>eC],68483);let eA=new WeakMap,eD=new WeakMap,ek=new WeakMap,eN=new WeakMap,eR=new WeakMap,eO={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eD.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ek.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eM(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eM(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eM(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eA.set(t,e)}).catch(()=>{}),eR.set(t,e),t}if(eN.has(e))return eN.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eL(this),t),eM(eA.get(this))}:function(...t){return eM(e.apply(eL(this),t))}:function(t,...r){let n=e.call(eL(this),t,...r);return ek.set(n,t.sort?t.sort():[t]),eM(n)};return e instanceof IDBTransaction&&function(e){if(eD.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eD.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eO):e}(e);return n!==e&&(eN.set(e,n),eR.set(n,e)),n}let eL=e=>eR.get(e);function eP(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=eM(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eM(a.result),e.oldVersion,e.newVersion,eM(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eF=["get","getKey","getAll","getAllKeys","count"],eV=["put","add","delete","clear"],eB=new Map;function eU(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eB.get(t))return eB.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eV.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eF.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eB.set(t,s),s}eO={...n=eO,get:(e,t,r)=>eU(e,t)||n.get(e,t,r),has:(e,t)=>!!eU(e,t)||n.has(e,t)},e.s(["openDB",()=>eP],44435);class eq{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if((null==(t=e.getComponent())?void 0:t.type)!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ez="@firebase/app",ej="0.13.1",e$=new eS("@firebase/app"),eK="[DEFAULT]",eG={[ez]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eQ=new Map,eH=new Map,eW=new Map;function eX(e,t){try{e.container.addComponent(t)}catch(r){e$.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eY(e,t){e.container.addOrOverwriteComponent(t)}function eJ(e){let t=e.name;if(eW.has(t))return e$.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eW.set(t,e),eQ.values()))eX(r,e);for(let t of eH.values())eX(t,e);return!0}function eZ(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function e0(e,t,r=eK){eZ(e,t).clearInstance(r)}function e1(e){return void 0!==e.options}function e2(e){return null!=e&&void 0!==e.settings}function e6(){eW.clear()}let e3=new en("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e5{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new em("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e3.create("app-deleted",{appName:this._name})}}function e4(e,t){let r=A(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e8 extends e5{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&e4(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e4(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,ti(ez,ej,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tn(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e3.create("server-app-deleted")}}let e7="11.9.0";function e9(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:eK,automaticDataCollectionEnabled:!0},t),i=n.name;if("string"!=typeof i||!i)throw e3.create("bad-app-name",{appName:String(i)});if(r||(r=O()),!r)throw e3.create("no-options");let s=eQ.get(i);if(s)if(ea(r,s.options)&&ea(n,s.config))return s;else throw e3.create("duplicate-app",{appName:i});let a=new ew(i);for(let e of eW.values())a.addComponent(e);let o=new e5(r,n,a);return eQ.set(i,o),o}function te(e,t){let r;if(K()&&!G())throw e3.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!0),r=e1(e)?e.options:e;let n=Object.assign(Object.assign({},t),r);if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e3.create("finalization-registry-not-supported",{});let i=""+[...JSON.stringify(n)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),s=eH.get(i);if(s)return s.incRefCount(t.releaseOnDeref),s;let a=new ew(i);for(let e of eW.values())a.addComponent(e);let o=new e8(r,t,i,a);return eH.set(i,o),o}function tt(e=eK){let t=eQ.get(e);if(!t&&e===eK&&O())return e9();if(!t)throw e3.create("no-app",{appName:e});return t}function tr(){return Array.from(eQ.values())}async function tn(e){let t=!1,r=e.name;eQ.has(r)?(t=!0,eQ.delete(r)):eH.has(r)&&0>=e.decRefCount()&&(eH.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function ti(e,t,r){var n;let i=null!=(n=eG[e])?n:e;r&&(i+=`-${r}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e$.warn(e.join(" "));return}eJ(new em(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function ts(e,t){if(null!==e&&"function"!=typeof e)throw e3.create("invalid-log-argument");eC(e,t)}function ta(e){ex(e)}let to="firebase-heartbeat-store",tl=null;function tu(){return tl||(tl=eP("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(to)}catch(e){console.warn(e)}}}).catch(e=>{throw e3.create("idb-open",{originalErrorMessage:e.message})})),tl}async function th(e){try{let t=(await tu()).transaction(to),r=await t.objectStore(to).get(td(e));return await t.done,r}catch(e){if(e instanceof er)e$.warn(e.message);else{let t=e3.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});e$.warn(t.message)}}}async function tc(e,t){try{let r=(await tu()).transaction(to,"readwrite"),n=r.objectStore(to);await n.put(t,td(e)),await r.done}catch(e){if(e instanceof er)e$.warn(e.message);else{let t=e3.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});e$.warn(t.message)}}}function td(e){return`${e.name}!${e.options.appId}`}class tf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tg(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=tp();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e$.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=tp(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tm(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tm(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=C(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return e$.warn(e),""}}}function tp(){return new Date().toISOString().substring(0,10)}class tg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Z()&&ee().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await th(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return tc(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return tc(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function tm(e){return C(JSON.stringify({version:2,heartbeats:e})).length}eJ(new em("platform-logger",e=>new eq(e),"PRIVATE")),eJ(new em("heartbeat",e=>new tf(e),"PRIVATE")),ti(ez,ej,""),ti(ez,ej,"esm2017"),ti("fire-js",""),e.s(["SDK_VERSION",()=>e7,"_DEFAULT_ENTRY_NAME",()=>eK,"_addComponent",()=>eX,"_addOrOverwriteComponent",()=>eY,"_apps",()=>eQ,"_clearComponents",()=>e6,"_components",()=>eW,"_getProvider",()=>eZ,"_isFirebaseApp",()=>e1,"_isFirebaseServerApp",()=>e2,"_registerComponent",()=>eJ,"_removeServiceInstance",()=>e0,"_serverApps",()=>eH,"deleteApp",()=>tn,"getApp",()=>tt,"getApps",()=>tr,"initializeApp",()=>e9,"initializeServerApp",()=>te,"onLog",()=>ts,"registerVersion",()=>ti,"setLogLevel",()=>ta],85086);var ty="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tv={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^r&(i^s))+n[0]+0xd76aa478|0;a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var s,l={};function u(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(h(-e));for(var t=[],r=1,n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){for(var t=e.g.length,r=[],n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(g(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(s=h(r)).j(t);g(a)||0<a.l(e);)r-=n,a=(s=h(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){for(var t=e.g.length+1,r=[],n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function I(e,t){var r=t>>5;t%=32;for(var n=e.g.length-r,s=[],a=0;a<n;a++)s[a]=0<t?e.i(a+r)>>>t|e.i(a+r+1)<<32-t:e.i(a+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=h(Math.pow(e,6)),r=this,n="";;){var i=b(r,t).g,s=((0<(r=y(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0,s=0;s<=t;s++){var a=n+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);n=o>>>16,a&=65535,o&=65535,r[s]=o<<16|a}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(var s=0;s<e.g.length;s++){var a=this.i(n)>>>16,o=65535&this.i(n),l=e.i(s)>>>16,u=65535&e.i(s);r[2*n+2*s]+=o*u,v(r,2*n+2*s),r[2*n+2*s+1]+=a*u,v(r,2*n+2*s+1),r[2*n+2*s+1]+=o*l,v(r,2*n+2*s+1),r[2*n+2*s+2]+=a*l,v(r,2*n+2*s+2)}for(n=0;n<t;n++)r[n]=r[2*n+1]<<16|r[2*n];for(n=t;n<2*t;n++)r[n]=0;return new i(r,0)},s.A=function(e){return b(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,o=tv.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=h(Math.pow(r,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),r);8>a?(a=h(Math.pow(r,a)),i=i.j(a).add(h(o))):i=(i=i.j(n)).add(h(o))}return i},a=tv.Integer=i}).apply(void 0!==ty?ty:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var tw="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,tb={};(function(){var e,t,r,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof tw&&tw];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var r=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in r))break e;r=r[a]}(t=t(s=r[e=e[e.length-1]]))!=s&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,r,n,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),r=0,n=!1,(i={next:function(){if(!n&&r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,r){return e.call.apply(e.bind,arguments)}function v(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function w(e,t,r){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}function I(e){let t=e.length;if(0<t){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(o(r)){let t=e.length||0,n=r.length||0;e.length=t+n;for(let i=0;i<n;i++)e[t+i]=r[i]}else e.push(r)}}function T(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function x(e){return x[" "](e),e}x[" "]=function(){};var C=-1!=S().indexOf("Gecko")&&(-1==S().toLowerCase().indexOf("webkit")||-1!=S().indexOf("Edge"))&&-1==S().indexOf("Trident")&&-1==S().indexOf("MSIE")&&-1==S().indexOf("Edge");function A(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function D(e){let t={};for(let r in e)t[r]=e[r];return t}let k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<k.length;t++)r=k[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new O,e=>e.reset());class O{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let M,L=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let r=R.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},F=()=>{let e=a.Promise.resolve(void 0);M=()=>{e.then(V)}};var V=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}R.j(t),100>R.h&&(R.h++,t.next=R.g,R.g=t)}L=!1};function B(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function z(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(C){e:{try{x(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}E(z,U);var j={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var $="closure_listenable_"+(1e6*Math.random()|0),K=0;function G(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++K,this.da=this.fa=!1}function Q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function H(e){this.src=e,this.g={},this.h=0}function W(e,t){var r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=0<=s)&&Array.prototype.splice.call(i,s,1),n&&(Q(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function X(e,t,r,n){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}H.prototype.add=function(e,t,r,n,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=X(e,t,n,i);return -1<a?(t=e[a],r||(t.fa=!1)):((t=new G(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var Y="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,o=en(e);if(o||(e[Y]=o=new H(e)),(r=o.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return er.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)q||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(et(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[$])W(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(et(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=en(t))?(W(r,e),0==r.h&&(r.src=null,t[Y]=null)):Q(e)}}}function et(e){return e in J?J[e]:J[e]="on"+e}function er(e,t){if(e.da)e=!0;else{t=new z(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&ee(e),e=r.call(n,t)}return e}function en(e){return(e=e[Y])instanceof H?e:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[ei]||(e[ei]=function(t){return e.handleEvent(t)}),e[ei])}function ea(){B.call(this),this.i=new H(this),this.M=this,this.F=null}function eo(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var i=t;N(t=new U(n,e),i)}if(i=!0,r)for(var s=r.length-1;0<=s;s--){var a=t.g=r[s];i=el(a,n,!0,t)&&i}if(i=el(a=t.g=e,n,!0,t)&&i,i=el(a,n,!1,t)&&i,r)for(s=0;s<r.length;s++)i=el(a=t.g=r[s],n,!1,t)&&i}function el(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==r){var o=a.listener,l=a.ha||a.src;a.fa&&W(e.i,a),i=!1!==o.call(l,n)&&i}}return i&&!n.defaultPrevented}function eu(e,t,r){if("function"==typeof e)r&&(e=w(e,r));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}E(ea,B),ea.prototype[$]=!0,ea.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=m(i)?!!i.capture:!!i,n=es(n),t&&t[$])?(t=t.i,(r=String(r).toString())in t.g&&-1<(n=X(a=t.g[r],n,i,s))&&(Q(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete t.g[r],t.h--))):t&&(t=en(t))&&(r=t.g[r.toString()],t=-1,r&&(t=X(r,n,i,s)),(n=-1<t?r[t]:null)&&ee(n))}(this,e,t,r,n)},ea.prototype.N=function(){if(ea.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)Q(r[n]);delete t.g[e],t.h--}}this.F=null},ea.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},ea.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class eh extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eu(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){B.call(this),this.h=e,this.g={}}E(ec,B);var ed=[];function ef(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ef(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=a.JSON.stringify,eg=a.JSON.parse,em=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ey(){}function ev(e){return e.h||(e.h=e.i())}function ew(){}ey.prototype.h=null;var eb={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eE(){U.call(this,"d")}function eI(){U.call(this,"c")}E(eE,U),E(eI,U);var e_={},eT=null;function eS(){return eT=eT||new ea}function ex(e){U.call(this,e_.La,e)}function eC(e){let t=eS();eo(t,new ex(t))}function eA(e,t){U.call(this,e_.STAT_EVENT,e),this.stat=t}function eD(e){let t=eS();eo(t,new eA(t,e))}function ek(e,t){U.call(this,e_.Ma,e),this.size=t}function eN(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eR(){this.g=!0}function eO(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r){for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var i=n[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ep(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}e_.La="serverreachability",E(ex,U),e_.STAT_EVENT="statevent",E(eA,U),e_.Ma="timingevent",E(ek,U),eR.prototype.xa=function(){this.g=!1},eR.prototype.info=function(){};var eM={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eL={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eP(){}function eF(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eV}function eV(){this.i=null,this.g="",this.h=!1}E(eP,ey),eP.prototype.g=function(){return new XMLHttpRequest},eP.prototype.i=function(){return{}},t=new eP;var eB={},eU={};function eq(e,t,r){e.L=1,e.v=tr(e8(t)),e.m=r,e.P=!0,ez(e,null)}function ez(e,t){e.F=Date.now(),e$(e),e.A=e8(e.v);var r,n,i,s,a,o,l=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),tg(l.i,"t",u),e.C=0,l=e.j.J,e.h=new eV,e.g=t6(e.j,l?t:null,!e.m),0<e.O&&(e.M=new eh(w(e.Y,e,e.g),e.O)),t=e.U,l=e.g,u=e.ca;var h="readystatechange";Array.isArray(h)||(h&&(ed[0]=h.toString()),h=ed);for(var c=0;c<h.length;c++){var d=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=es(n),t&&t[$]?t.L(r,n,m(i)?!!i.capture:!!i,s):Z(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=es(n),t&&t[$]?t.K(r,n,m(i)?!!i.capture:!!i,s):Z(t,r,n,!1,i,s)}(l,h[c],u||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eC(),r=e.i,n=e.u,i=e.A,s=e.l,a=e.R,o=e.m,r.info(function(){if(r.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function ej(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function e$(e){e.S=Date.now()+e.I,eK(e,e.I)}function eK(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eN(w(e.ba,e),t)}function eG(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eQ(e){0==e.j.G||e.J||tJ(e.j,e)}function eH(e){eG(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ef(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eW(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||e0(r.h,e))){if(!e.K&&e0(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.u){if(r.g)if(r.g.F+3e3<e.F)tY(r),tq(r);else break e;tH(r),eD(18)}}else r.za=i[1],0<r.za-r.T&&37500>i[2]&&r.F&&0==r.v&&!r.C&&(r.C=eN(w(r.Za,r),6e3));if(1>=eZ(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else t0(r,11)}else if((e.K||r.g==e)&&tY(r),!T(t))for(i=r.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(r.T=o[0],o=o[1],2==r.G)if("c"==o[0]){r.K=o[1],r.ia=o[2];let t=o[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));let i=o[4];null!=i&&(r.Aa=i,r.j.info("SVER="+r.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(r.L=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e1(s,s.h),s.h=null))}if(n.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,tt(n.I,n.D,e))}}if(r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms")),(n=r).qa=t2(n,n.J?n.ia:null,n.W),e.K){e2(n.h,e);var a=n.L;a&&(e.I=a),e.B&&(eG(e),e$(e)),n.g=e}else tQ(n);0<r.i.length&&tj(r)}else"stop"!=o[0]&&"close"!=o[0]||t0(r,7);else 3==r.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(r,7):tU(r):"noop"!=o[0]&&r.l&&r.l.ta(o),r.v=0)}}eC(4)}catch(e){}}eF.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eF.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tF(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eC(3):eC(2)),eG(this);var r=this.g.Z();this.X=r;t:if(ej(this)){var n=tF(this.g);e="";var i=n.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eH(this),eQ(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(s&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==r,l=this.i,u=this.u,h=this.A,c=this.l,d=this.R,f=r,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+u+"\n"+h+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u,h,c,d,f,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(p)){var m=p;break t}}m=null}if(r=m)eO(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eW(this,r);else{this.o=!1,this.s=3,eD(12),eH(this),eQ(this);break e}}if(this.P){let e;for(r=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eU:isNaN(r=Number(t.substring(r,n)))?eB:(n+=1)+r>t.length?eU:(t=t.slice(n,n+r),e.C=n+r,t)}(this,o))==eU){4==v&&(this.s=4,eD(14),r=!1),eO(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eB){this.s=4,eD(15),eO(this.i,this.l,o,"[Invalid Chunk]"),r=!1;break}else eO(this.i,this.l,e,null),eW(this,e);if(ej(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,eD(16),r=!1),this.o=this.o&&r,r){if(0<o.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tW(y),y.M=!0,eD(11))}}else eO(this.i,this.l,o,"[Invalid Chunked Response]"),eH(this),eQ(this)}else eO(this.i,this.l,o,null),eW(this,o);4==v&&eH(this),this.o&&!this.J&&(4==v?tJ(this.j,this):(this.o=!1,e$(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(T(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==r&&0<o.indexOf("Unknown SID")?(this.s=3,eD(12)):(this.s=0,eD(13)),eH(this),eQ(this)}}}catch(e){}finally{}},eF.prototype.cancel=function(){this.J=!0,eH(this)},eF.prototype.ba=function(){var e,t;this.B=null;let r=Date.now();0<=r-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eC(),eD(17)),eH(this),this.s=2,eQ(this)):eK(this,this.S-r)};var eX=class{constructor(e,t){this.g=e,this.map=t}};function eY(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eJ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eZ(e){return e.h?1:e.g?e.g.size:0}function e0(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e1(e,t){e.g?e.g.add(t):e.h=t}function e2(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e6(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.D);return t}return I(e.i)}function e3(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}for(let n in t=[],r=0,e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),i=n.length,s=0;s<i;s++)t.call(void 0,n[s],r&&r[s],e)}eY.prototype.cancel=function(){if(this.i=e6(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e5=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e4(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e4){this.h=e.h,e7(this,e.j),this.o=e.o,this.g=e.g,e9(this,e.s),this.l=e.l;var t=e.i,r=new tc;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),te(this,r),this.m=e.m}else e&&(t=String(e).match(e5))?(this.h=!1,e7(this,t[1]||"",!0),this.o=tn(t[2]||""),this.g=tn(t[3]||"",!0),e9(this,t[4]),this.l=tn(t[5]||"",!0),te(this,t[6]||"",!0),this.m=tn(t[7]||"")):(this.h=!1,this.i=new tc(null,this.h))}function e8(e){return new e4(e)}function e7(e,t,r){e.j=r?tn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e9(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function te(e,t,r){var n,i;t instanceof tc?(e.i=t,n=e.i,(i=e.h)&&!n.j&&(td(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(tf(this,t),tg(this,r,e))},n)),n.j=i):(r||(t=ti(t,tu)),e.i=new tc(t,e.h))}function tt(e,t,r){e.i.set(t,r)}function tr(e){return tt(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ti(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,ts),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ts(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e4.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ti(t,ta,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ti(t,ta,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(ti(r,"/"==r.charAt(0)?tl:to,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",ti(r,th)),e.join("")};var ta=/[#\/\?@]/g,to=/[#\?:]/g,tl=/[#\?]/g,tu=/[#\?@]/g,th=/#/g;function tc(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function td(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),i=null;if(0<=n){var s=e[r].substring(0,n);i=e[r].substring(n+1)}else s=e[r];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tf(e,t){td(e),t=tm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tp(e,t){return td(e),t=tm(e,t),e.g.has(t)}function tg(e,t,r){tf(e,t),0<r.length&&(e.i=null,e.g.set(tm(e,t),I(r)),e.h+=r.length)}function tm(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ty(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tv(){this.g=new em}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function tI(e,t){ea.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function t_(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tT(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tS(e)}function tS(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tx(e){let t="";return A(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tx(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):tt(e,t,r))}function tA(e){ea.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=tc.prototype).add=function(e,t){td(this),this.i=null,e=tm(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},r.forEach=function(e,t){td(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},r.na=function(){td(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){let i=e[n];for(let e=0;e<i.length;e++)r.push(t[n])}return r},r.V=function(e){td(this);let t=[];if("string"==typeof e)tp(this,e)&&(t=t.concat(this.g.get(tm(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},r.set=function(e,t){return td(this),this.i=null,tp(this,e=tm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];let s=encodeURIComponent(String(n)),a=this.V(n);for(n=0;n<a.length;n++){var i=s;""!==a[n]&&(i+="="+encodeURIComponent(String(a[n]))),e.push(i)}}return this.i=e.join("&")},E(tE,ey),tE.prototype.g=function(){return new tI(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),E(tI,ea),(r=tI.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tS(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tT(this)),this.readyState=0},r.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tS(this)),this.g&&(this.readyState=3,tS(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;t_(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tT(this):tS(this),3==this.readyState&&t_(this)}},r.Ra=function(e){this.g&&(this.response=this.responseText=e,tT(this))},r.Qa=function(e){this.g&&(this.response=e,tT(this))},r.ga=function(){this.g&&tT(this)},r.setRequestHeader=function(e,t){this.u.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tI.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(tA,ea);var tD=/^https?$/i,tk=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tM(e)}function tR(e){e.A||(e.A=!0,eo(e,"complete"),eo(e,"error"))}function tO(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))eu(e.Ea,0,e);else if(eo(e,"readystatechange"),4==tP(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){var i=String(e.D).match(e5)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),r=!tD.test(i?i.toLowerCase():"")}t=r}if(t)eo(e,"complete"),eo(e,"success");else{e.m=6;try{var o=2<tP(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tR(e)}}finally{tM(e)}}}}function tM(e,t){if(e.g){tL(e);let r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eo(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function tL(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tF(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tV(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eR,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tV("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tV("baseRetryDelayMs",5e3,e),this.cb=tV("retryDelaySeedMs",1e4,e),this.Wa=tV("forwardChannelMaxRetries",2,e),this.wa=tV("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eY(e&&e.concurrentRequestLimit),this.Da=new tv,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(tz(e),3==e.G){var t=e.U++,r=e8(e.I);if(tt(r,"SID",e.K),tt(r,"RID",t),tt(r,"TYPE","terminate"),tK(e,r),(t=new eF(e,e.j,t)).L=2,t.v=tr(e8(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.v,r=!0),r||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),e$(t)}t1(e)}function tq(e){e.g&&(tW(e),e.g.cancel(),e.g=null)}function tz(e){tq(e),e.u&&(a.clearTimeout(e.u),e.u=null),tY(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tj(e){if(!eJ(e.h)&&!e.s){e.s=!0;var t=e.Ga;M||F(),L||(M(),L=!0),P.add(t,e),e.B=0}}function t$(e,t){var r;r=t?t.l:e.U++;let n=e8(e.I);tt(n,"SID",e.K),tt(n,"RID",r),tt(n,"AID",e.T),tK(e,n),e.m&&e.o&&tC(n,e.m,e.o),r=new eF(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tG(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e1(e.h,r),eq(r,n,t)}function tK(e,t){e.H&&A(e.H,function(e,r){tt(t,r,e)}),e.l&&e3({},function(e,r){tt(t,r,e)})}function tG(e,t,r){r=Math.min(e.i.length,r);var n=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?0<r?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<r;a++){let r=i[a].g,o=i[a].map;if(0>(r-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,r){let n=r||"";try{e3(e,function(e,r){let i=e;m(e)&&(i=ep(e)),t.push(n+r+"="+encodeURIComponent(i))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+r+"_")}catch(e){n&&n(o)}}if(s){n=e.join("&");break e}}}return t.D=e=e.i.splice(0,r),n}function tQ(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;M||F(),L||(M(),L=!0),P.add(t,e),e.v=0}}function tH(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eN(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tW(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eF(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e8(e.qa);tt(t,"RID","rpc"),tt(t,"SID",e.K),tt(t,"AID",e.T),tt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tt(t,"TO",e.ja),tt(t,"TYPE","xmlhttp"),tK(e,t),e.m&&e.o&&tC(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=tr(e8(t)),r.m=null,r.P=!0,ez(r,e)}function tY(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tJ(e,t){var r,n=null;if(e.g==t){tY(e),tW(e),e.g=null;var i=2}else{if(!e0(e.h,t))return;n=t.D,e2(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eo(i=eS(),new ek(i,n)),tj(e)}else tQ(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(r=t,!(eZ(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=r.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eN(w(e.Ga,e,r),tZ(e,e.B)),e.B++,!0)))||2==i&&tH(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=w(e.fb,e),i=e.Xa;let l=!i;i=new e4(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e7(i,"https"),tr(i),l?function(e,t){let r=new eR;if(a.Image){let n=new Image;n.onload=b(ty,r,"TestLoadImage: loaded",!0,t,n),n.onerror=b(ty,r,"TestLoadImage: error",!1,t,n),n.onabort=b(ty,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=b(ty,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eR,s=new AbortController,o=setTimeout(()=>{s.abort(),ty(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?ty(t,"TestPingServer: ok",!0,n):ty(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),ty(t,"TestPingServer: error",!1,n)}))}else eD(2);e.G=0,e.l&&e.l.sa(t),t1(e),tz(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e6(e.h);(0!=t.length||0!=e.i.length)&&(_(e.ka,t),_(e.ka,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,r){var n=r instanceof e4?e8(r):new e4(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e9(n,n.s);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e4(null);n&&e7(s,n),t&&(s.g=t),i&&e9(s,i),r&&(s.l=r),n=s}return r=e.D,t=e.ya,r&&t&&tt(n,r,t),tt(n,"VER",e.la),tK(e,n),n}function t6(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tA(e.Ca&&!e.pa?new tE({eb:r}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){ea.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!T(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eE.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){eI.call(this),this.status=1}function t9(e){this.g=e}(r=tA.prototype).Ha=function(e){this.J=e},r.ea=function(e,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);r=r?r.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ev(this.o):ev(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(r,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tk,r,void 0))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tL(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eo(this,"complete"),eo(this,"abort"),tM(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tM(this,!0)),tA.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?tO(this):this.bb())},r.bb=function(){tO(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=tB.prototype).la=8,r.G=1,r.connect=function(e,t,r,n){eD(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=t2(this,null,this.W),tj(this)},r.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eF(this,this.j,e),s=this.o;if(this.S&&(s?N(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tG(this,i,t),tt(r=e8(this.I),"RID",e),tt(r,"CVER",22),this.D&&tt(r,"X-HTTP-Session-Id",this.D),tK(this,r),s&&(this.O?t="headers="+encodeURIComponent(String(tx(s)))+"&"+t:this.m&&tC(r,this.m,s)),e1(this.h,i),this.Ua&&tt(r,"TYPE","init"),this.P?(tt(r,"$req",t),tt(r,"SID","null"),i.T=!0,eq(i,r,null)):eq(i,r,t),this.G=2}}else 3==this.G&&(e?t$(this,e):0==this.i.length||eJ(this.h)||t$(this))},r.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eN(w(this.ab,this),e)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eD(10),tq(this),tX(this))},r.Za=function(){null!=this.C&&(this.C=null,tq(this),tH(this),eD(19))},r.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eD(2)):(this.j.info("Failed to ping google.com"),eD(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=t3.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},E(t4,ea),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tU(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=ep(e),e=r);t.i.push(new eX(t.Ya++,e)),3==t.G&&tj(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t4.aa.N.call(this)},E(t8,eE),E(t7,eI),E(t9,t3),t9.prototype.ua=function(){eo(this.g,"a")},t9.prototype.ta=function(e){eo(this.g,new t8(e))},t9.prototype.sa=function(e){eo(this.g,new t7)},t9.prototype.ra=function(){eo(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,g=tb.createWebChannelTransport=function(){return new t5},p=tb.getStatEventTarget=function(){return eS()},f=tb.Event=e_,d=tb.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eM.NO_ERROR=0,eM.TIMEOUT=8,eM.HTTP_ERROR=6,c=tb.ErrorCode=eM,eL.COMPLETE="complete",h=tb.EventType=eL,ew.EventType=eb,eb.OPEN="a",eb.CLOSE="b",eb.ERROR="c",eb.MESSAGE="d",ea.prototype.listen=ea.prototype.K,u=tb.WebChannel=ew,tb.FetchXmlHttpFactory=tE,tA.prototype.listenOnce=tA.prototype.L,tA.prototype.getLastError=tA.prototype.Ka,tA.prototype.getLastErrorCode=tA.prototype.Ba,tA.prototype.getStatus=tA.prototype.Z,tA.prototype.getResponseJson=tA.prototype.Oa,tA.prototype.getResponseText=tA.prototype.oa,tA.prototype.send=tA.prototype.ea,tA.prototype.setWithCredentials=tA.prototype.Ha,l=tb.XhrIo=tA}).apply(void 0!==tw?tw:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let tE="@firebase/firestore",tI="4.7.17";class t_{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}t_.UNAUTHENTICATED=new t_(null),t_.GOOGLE_CREDENTIALS=new t_("google-credentials-uid"),t_.FIRST_PARTY=new t_("first-party-uid"),t_.MOCK_USER=new t_("mock-user");let tT="11.9.0",tS=new eS("@firebase/firestore");function tx(){return tS.logLevel}function tC(e){tS.setLogLevel(e)}function tA(e,...t){if(tS.logLevel<=s.DEBUG){let r=t.map(tN);tS.debug(`Firestore (${tT}): ${e}`,...r)}}function tD(e,...t){if(tS.logLevel<=s.ERROR){let r=t.map(tN);tS.error(`Firestore (${tT}): ${e}`,...r)}}function tk(e,...t){if(tS.logLevel<=s.WARN){let r=t.map(tN);tS.warn(`Firestore (${tT}): ${e}`,...r)}}function tN(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tR(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,tO(e,n,r)}function tO(e,t,r){let n=`FIRESTORE (${tT}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw tD(n),Error(n)}function tM(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||tO(t,i,n)}function tL(e,t){e||tR(57014,t)}let tP={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tF extends er{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tV{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tB{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(t_.UNAUTHENTICATED))}shutdown(){}}class tq{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tz{constructor(e){this.t=e,this.currentUser=t_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tM(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new tV;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tV,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tA("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tA("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tV)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tA("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tM("string"==typeof t.accessToken,31837,{l:t}),new tB(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tM(null===e||"string"==typeof e,2055,{h:e}),new t_(e)}}class tj{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=t_.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class t${constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tj(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(t_.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tK{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tG{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,e2(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tM(void 0===this.o,3512);let r=e=>{null!=e.error&&tA("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tA("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tA("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):tA("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tK(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tM("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tK(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tQ{getToken(){return Promise.resolve(new tK(""))}invalidateToken(){}start(e,t){}shutdown(){}}function tH(){return new TextEncoder}class tW{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function tX(e,t){return e<t?-1:+(e>t)}function tY(e,t){let r=0;for(;r<e.length&&r<t.length;){let n=e.codePointAt(r),i=t.codePointAt(r);if(n!==i){if(n<128&&i<128)return tX(n,i);{let s=tH(),a=function(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return tX(e[r],t[r]);return tX(e.length,t.length)}(s.encode(tJ(e,r)),s.encode(tJ(t,r)));return 0!==a?a:tX(n,i)}}r+=n>65535?2:1}return tX(e.length,t.length)}function tJ(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function tZ(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}class t0{static now(){return t0.fromMillis(Date.now())}static fromDate(e){return t0.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new t0(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tF(tP.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tF(tP.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tX(this.nanoseconds,e.nanoseconds):tX(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class t1{static fromTimestamp(e){return new t1(e)}static min(){return new t1(new t0(0,0))}static max(){return new t1(new t0(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let t2="__name__";class t6{constructor(e,t,r){void 0===t?t=0:t>e.length&&tR(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tR(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===t6.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof t6?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=t6.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return tX(e.length,t.length)}static compareSegments(e,t){let r=t6.isNumericId(e),n=t6.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?t6.extractNumericId(e).compare(t6.extractNumericId(t)):tY(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class t3 extends t6{construct(e,t,r){return new t3(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new tF(tP.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new t3(t)}static emptyPath(){return new t3([])}}let t5=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class t4 extends t6{construct(e,t,r){return new t4(e,t,r)}static isValidIdentifier(e){return t5.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t4.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===t2}static keyField(){return new t4([t2])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new tF(tP.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new tF(tP.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tF(tP.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new tF(tP.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t4(t)}static emptyPath(){return new t4([])}}class t8{constructor(e){this.path=e}static fromPath(e){return new t8(t3.fromString(e))}static fromName(e){return new t8(t3.fromString(e).popFirst(5))}static empty(){return new t8(t3.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===t3.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return t3.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t8(new t3(e.slice()))}}class t7{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function t9(e){return e.fields.find(e=>2===e.kind)}function re(e){return e.fields.filter(e=>2!==e.kind)}function rt(e,t){let r=tX(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=t4.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:tX(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return tX(e.fields.length,t.fields.length)}t7.UNKNOWN_ID=-1;class rr{constructor(e,t){this.fieldPath=e,this.kind=t}}class rn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rn(0,ra.min())}}function ri(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new ra(t1.fromTimestamp(1e9===n?new t0(r+1,0):new t0(r,n)),t8.empty(),t)}function rs(e){return new ra(e.readTime,e.key,-1)}class ra{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ra(t1.min(),t8.empty(),-1)}static max(){return new ra(t1.max(),t8.empty(),-1)}}function ro(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=t8.comparator(e.documentKey,t.documentKey))?r:tX(e.largestBatchId,t.largestBatchId)}let rl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ru{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rh(e){if(e.code!==tP.FAILED_PRECONDITION||e.message!==rl)throw e;tA("LocalStore","Unexpectedly lost primary lease")}class rc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tR(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rc((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rc?t:rc.resolve(t)}catch(e){return rc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rc.reject(t)}static resolve(e){return new rc((t,r)=>{t(e)})}static reject(e){return new rc((t,r)=>{r(e)})}static waitFor(e){return new rc((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=rc.resolve(!1);for(let r of e)t=t.next(e=>e?rc.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new rc((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new rc((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let rd="SimpleDb";class rf{static open(e,t,r,n){try{return new rf(t,e.transaction(n,r))}catch(e){throw new ry(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new tV,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ry(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=rI(t.target.error);this.S.reject(new ry(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tA(rd,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rw(this.transaction.objectStore(e))}}class rp{static delete(e){return tA(rd,"Removing database:",e),rb(D().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Z())return!1;if(rp.F())return!0;let e=z(),t=rp.M(e),r=rg(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){var e;return void 0!==b.default&&"YES"===(null==(e=b.default.__PRIVATE_env)?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,12.2===rp.M(z())&&tD("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(tA(rd,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new ry(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new tF(tP.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new tF(tP.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new ry(e,n))},n.onupgradeneeded=e=>{tA(rd,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,n.transaction,e.oldVersion,this.version).next(()=>{tA(rd,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.L=t.version},{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.k(e);let t=rf.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),rc.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(tA(rd,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function rg(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class rm{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return rb(this.K.delete())}}class ry extends tF{constructor(e,t){super(tP.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rv(e){return"IndexedDbTransactionError"===e.name}class rw{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tA(rd,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tA(rd,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rb(r)}add(e){return tA(rd,"ADD",this.store.name,e,e),rb(this.store.add(e))}get(e){return rb(this.store.get(e)).next(t=>(void 0===t&&(t=null),tA(rd,"GET",this.store.name,e,t),t))}delete(e){return tA(rd,"DELETE",this.store.name,e),rb(this.store.delete(e))}count(){return tA(rd,"COUNT",this.store.name),rb(this.store.count())}J(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new rc((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.Y(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new rc((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){tA(rd,"DELETE ALL",this.store.name);let r=this.options(e,t);r.ee=!1;let n=this.cursor(r);return this.Y(n,(e,t,r)=>r.delete())}te(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.Y(n,t)}ne(e){let t=this.cursor({});return new rc((r,n)=>{t.onerror=e=>{n(rI(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}Y(e,t){let r=[];return new rc((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new rm(i),a=t(i.primaryKey,i.value,s);if(a instanceof rc){let e=a.catch(e=>(s.done(),rc.reject(e)));r.push(e)}s.isDone?n():null===s.j?i.continue():i.continue(s.j)}}).next(()=>rc.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.ee?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rb(e){return new rc((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(rI(e.target.error))}})}let rE=!1;function rI(e){let t=rp.M(z());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new tF("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rE||(rE=!0,setTimeout(()=>{throw e},0)),e}}return e}let r_="IndexBackfiller";class rT{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){tA(r_,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.re.se();tA(r_,`Documents written: ${e}`)}catch(e){rv(e)?tA(r_,"Ignoring IndexedDB error during index backfill: ",e):await rh(e)}await this.ie(6e4)})}}class rS{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))}oe(e,t){let r=new Set,n=t,i=!0;return rc.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return tA(r_,`Processing collection: ${t}`),this._e(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}_e(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ae(n,r)).next(r=>(tA(r_,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}ae(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=rs(t);ro(n,r)>0&&(r=n)}),new ra(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rx{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}function rC(e){return null==e}function rA(e){return 0===e&&1/e==-1/0}function rD(e){return"number"==typeof e&&Number.isInteger(e)&&!rA(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rk(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}rx.le=-1;function rN(e){let t=e.length;if(tM(t>=2,64408,{path:e}),2===t)return tM("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),t3.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&tR(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:tR(61167,{path:e})}s=t+2}return new t3(n)}let rR="remoteDocuments",rO="owner",rM="owner",rL="mutationQueues",rP="mutations",rF="batchId",rV="userMutationsIndex",rB=["userId","batchId"],rU={},rq="documentMutations",rz="remoteDocumentsV14",rj=["prefixPath","collectionGroup","readTime","documentId"],r$="documentKeyIndex",rK=["prefixPath","collectionGroup","documentId"],rG="collectionGroupIndex",rQ=["collectionGroup","readTime","prefixPath","documentId"],rH="remoteDocumentGlobal",rW="remoteDocumentGlobalKey",rX="targets",rY="queryTargetsIndex",rJ=["canonicalId","targetId"],rZ="targetDocuments",r0=["targetId","path"],r1="documentTargetsIndex",r2=["path","targetId"],r6="targetGlobalKey",r3="targetGlobal",r5="collectionParents",r4=["collectionId","parent"],r8="clientMetadata",r7="bundles",r9="namedQueries",ne="indexConfiguration",nt="collectionGroupIndex",nr="indexState",nn=["indexId","uid"],ni="sequenceNumberIndex",ns=["uid","sequenceNumber"],na="indexEntries",no=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],nl="documentKeyIndex",nu=["indexId","uid","orderedDocumentKey"],nh="documentOverlays",nc=["userId","collectionPath","documentId"],nd="collectionPathOverlayIndex",nf=["userId","collectionPath","largestBatchId"],np="collectionGroupOverlayIndex",ng=["userId","collectionGroup","largestBatchId"],nm="globals",ny=[rL,rP,rq,rR,rX,rO,r3,rZ,r8,rH,r5,r7,r9],nv=[...ny,nh],nw=[rL,rP,rq,rz,rX,rO,r3,rZ,r8,rH,r5,r7,r9,nh],nb=[...nw,ne,nr,na],nE=[...nb,nm];class nI extends ru{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function n_(e,t){return rp.N(e.he,t)}function nT(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function nS(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function nx(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function nC(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nA{constructor(e,t){this.comparator=e,this.root=t||nk.EMPTY}insert(e,t){return new nA(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nk.BLACK,null,null))}remove(e){return new nA(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nk.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nD(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nD(this.root,e,this.comparator,!1)}getReverseIterator(){return new nD(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nD(this.root,e,this.comparator,!0)}}class nD{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nk{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:nk.RED,this.left=null!=n?n:nk.EMPTY,this.right=null!=i?i:nk.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new nk(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return nk.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return nk.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nk.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nk.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tR(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tR(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tR(27949);return e+ +!this.isRed()}}nk.EMPTY=null,nk.RED=!0,nk.BLACK=!1,nk.EMPTY=new class{constructor(){this.size=0}get key(){throw tR(57766)}get value(){throw tR(16141)}get color(){throw tR(16727)}get left(){throw tR(29726)}get right(){throw tR(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new nk(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nN{constructor(e){this.comparator=e,this.data=new nA(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nR(this.data.getIterator())}getIteratorFrom(e){return new nR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nN)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nN(this.comparator);return t.data=e,t}}class nR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function nO(e){return e.hasNext()?e.getNext():void 0}class nM{constructor(e){this.fields=e,e.sort(t4.comparator)}static empty(){return new nM([])}unionWith(e){let t=new nN(t4.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new nM(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tZ(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nL extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function nP(){return"undefined"!=typeof atob}class nF{constructor(e){this.binaryString=e}static fromBase64String(e){return new nF(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new nL("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nF(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tX(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nF.EMPTY_BYTE_STRING=new nF("");let nV=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nB(e){if(tM(!!e,39018),"string"==typeof e){let t=0,r=nV.exec(e);if(tM(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nU(e.seconds),nanos:nU(e.nanos)}}function nU(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nq(e){return"string"==typeof e?nF.fromBase64String(e):nF.fromUint8Array(e)}let nz="server_timestamp",nj="__type__",n$="__previous_value__",nK="__local_write_time__";function nG(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nj])?void 0:r.stringValue)===nz}function nQ(e){let t=e.mapValue.fields[n$];return nG(t)?nQ(t):t}function nH(e){let t=nB(e.mapValue.fields[nK].timestampValue);return new t0(t.seconds,t.nanos)}class nW{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let nX="(default)";class nY{constructor(e,t){this.projectId=e,this.database=t||nX}static empty(){return new nY("","")}get isDefaultDatabase(){return this.database===nX}isEqual(e){return e instanceof nY&&e.projectId===this.projectId&&e.database===this.database}}let nJ="__type__",nZ="__max__",n0={mapValue:{fields:{__type__:{stringValue:nZ}}}},n1="__vector__",n2="value",n6={nullValue:"NULL_VALUE"};function n3(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nG(e)?4:ih(e)?0x1fffffffffffff:il(e)?10:11:tR(28295,{value:e})}function n5(e,t){if(e===t)return!0;let r=n3(e);if(r!==n3(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nH(e).isEqual(nH(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=nB(e.timestampValue),i=nB(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nq(e.bytesValue).isEqual(nq(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nU(e.geoPointValue.latitude)===nU(t.geoPointValue.latitude)&&nU(e.geoPointValue.longitude)===nU(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nU(e.integerValue)===nU(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=nU(e.doubleValue),n=nU(t.doubleValue);return r===n?rA(r)===rA(n):isNaN(r)&&isNaN(n)}return!1;case 9:return tZ(e.arrayValue.values||[],t.arrayValue.values||[],n5);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(nT(s)!==nT(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!n5(s[e],a[e])))return!1;return!0;default:return tR(52216,{left:e})}}function n4(e,t){return void 0!==(e.values||[]).find(e=>n5(e,t))}function n8(e,t){var r,n,i,s,a,o,l,u,h,c;if(e===t)return 0;let d=n3(e),f=n3(t);if(d!==f)return tX(d,f);switch(d){case 0:case 0x1fffffffffffff:return 0;case 1:return tX(e.booleanValue,t.booleanValue);case 2:let p,g;return p=nU(e.integerValue||e.doubleValue),p<(g=nU(t.integerValue||t.doubleValue))?-1:p>g?1:p===g?0:isNaN(p)?isNaN(g)?0:-1:1;case 3:return n7(e.timestampValue,t.timestampValue);case 4:return n7(nH(e),nH(t));case 5:return tY(e.stringValue,t.stringValue);case 6:let m,y;return r=e.bytesValue,n=t.bytesValue,m=nq(r),y=nq(n),m.compareTo(y);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=tX(r[e],n[e]);if(0!==t)return t}return tX(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let v;return i=e.geoPointValue,s=t.geoPointValue,0!==(v=tX(nU(i.latitude),nU(s.latitude)))?v:tX(nU(i.longitude),nU(s.longitude));case 9:return n9(e.arrayValue,t.arrayValue);case 10:let w,b,E,I,_;return a=e.mapValue,o=t.mapValue,w=a.fields||{},b=o.fields||{},E=null==(l=w[n2])?void 0:l.arrayValue,I=null==(u=b[n2])?void 0:u.arrayValue,0!==(_=tX((null==(h=null==E?void 0:E.values)?void 0:h.length)||0,(null==(c=null==I?void 0:I.values)?void 0:c.length)||0))?_:n9(E,I);case 11:return function(e,t){if(e===n0.mapValue&&t===n0.mapValue)return 0;if(e===n0.mapValue)return 1;if(t===n0.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=tY(n[e],s[e]);if(0!==t)return t;let a=n8(r[n[e]],i[s[e]]);if(0!==a)return a}return tX(n.length,s.length)}(e.mapValue,t.mapValue);default:throw tR(23264,{Pe:d})}}function n7(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tX(e,t);let r=nB(e),n=nB(t),i=tX(r.seconds,n.seconds);return 0!==i?i:tX(r.nanos,n.nanos)}function n9(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=n8(r[e],n[e]);if(t)return t}return tX(r.length,n.length)}function ie(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=nB(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?nq(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,t8.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ie(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ie(e.fields[i])}`;return r+"}"}(e.mapValue):tR(61005,{value:e})}function it(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ir(e){return!!e&&"integerValue"in e}function ii(e){return!!e&&"arrayValue"in e}function is(e){return!!e&&"nullValue"in e}function ia(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function io(e){return!!e&&"mapValue"in e}function il(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nJ])?void 0:r.stringValue)===n1}function iu(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return nS(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=iu(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=iu(e.arrayValue.values[r]);return t}return Object.assign({},e)}function ih(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nZ}let ic={mapValue:{fields:{[nJ]:{stringValue:n1},[n2]:{arrayValue:{}}}}};function id(e,t){let r=n8(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function ip(e,t){let r=n8(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ig{constructor(e){this.value=e}static empty(){return new ig({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!io(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=iu(t)}setAll(e){let t=t4.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=iu(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());io(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return n5(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];io(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(nS(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new ig(iu(this.value))}}class im{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new im(e,0,t1.min(),t1.min(),t1.min(),ig.empty(),0)}static newFoundDocument(e,t,r,n){return new im(e,1,t,t1.min(),r,n,0)}static newNoDocument(e,t){return new im(e,2,t,t1.min(),t1.min(),ig.empty(),0)}static newUnknownDocument(e,t){return new im(e,3,t,t1.min(),t1.min(),ig.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(t1.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ig.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ig.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=t1.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof im&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new im(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class iy{constructor(e,t){this.position=e,this.inclusive=t}}function iv(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?t8.comparator(t8.fromName(a.referenceValue),r.key):n8(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function iw(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!n5(e.position[r],t.position[r]))return!1;return!0}class ib{constructor(e,t="asc"){this.field=e,this.dir=t}}class iE{}class iI extends iE{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new iD(e,t,r):"array-contains"===t?new iO(e,r):"in"===t?new iM(e,r):"not-in"===t?new iL(e,r):"array-contains-any"===t?new iP(e,r):new iI(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ik(e,r):new iN(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(n8(t,this.value)):null!==t&&n3(this.value)===n3(t)&&this.matchesComparison(n8(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tR(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class i_ extends iE{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new i_(e,t)}matches(e){return iT(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function iT(e){return"and"===e.op}function iS(e){return"or"===e.op}function ix(e){return iC(e)&&iT(e)}function iC(e){for(let t of e.filters)if(t instanceof i_)return!1;return!0}function iA(e,t){let r=e.filters.concat(t);return i_.create(r,e.op)}class iD extends iI{constructor(e,t,r){super(e,t,r),this.key=t8.fromName(r.referenceValue)}matches(e){let t=t8.comparator(e.key,this.key);return this.matchesComparison(t)}}class ik extends iI{constructor(e,t){super(e,"in",t),this.keys=iR("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class iN extends iI{constructor(e,t){super(e,"not-in",t),this.keys=iR("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function iR(e,t){var r;return((null==(r=t.arrayValue)?void 0:r.values)||[]).map(e=>t8.fromName(e.referenceValue))}class iO extends iI{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ii(t)&&n4(t.arrayValue,this.value)}}class iM extends iI{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&n4(this.value.arrayValue,t)}}class iL extends iI{constructor(e,t){super(e,"not-in",t)}matches(e){if(n4(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!n4(this.value.arrayValue,t)}}class iP extends iI{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ii(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>n4(this.value.arrayValue,e))}}class iF{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Ie=null}}function iV(e,t=null,r=[],n=[],i=null,s=null,a=null){return new iF(e,t,r,n,i,s,a)}function iB(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof iI)return t.field.canonicalString()+t.op.toString()+ie(t.value);if(ix(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rC(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ie(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ie(e)).join(",")),e.Ie=t}return e.Ie}function iU(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof iI?r instanceof iI&&t.op===r.op&&t.field.isEqual(r.field)&&n5(t.value,r.value):t instanceof i_?r instanceof i_&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void tR(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!iw(e.startAt,t.startAt)&&iw(e.endAt,t.endAt)}function iq(e){return t8.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iz(e,t){return e.filters.filter(e=>e instanceof iI&&e.field.isEqual(t))}function ij(e,t,r){let n=n6,i=!0;for(let r of iz(e,t)){let e=n6,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?n6:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?it(nY.empty(),t8.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?il(s)?ic:{mapValue:{}}:tR(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=n6}0>id({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>id({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function i$(e,t,r){let n=n0,i=!0;for(let r of iz(e,t)){let e=n0,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?it(nY.empty(),t8.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?ic:"mapValue"in s?il(s)?{mapValue:{}}:n0:tR(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=n0}ip({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];ip({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class iK{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function iG(e){return new iK(e)}function iQ(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iH(e){return null!==e.collectionGroup}function iW(e){if(null===e.Ee){let t;e.Ee=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nN(t4.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new ib(t,n))}),r.has(t4.keyField().canonicalString())||e.Ee.push(new ib(t4.keyField(),n))}return e.Ee}function iX(e){return e.de||(e.de=iJ(e,iW(e))),e.de}function iY(e){return e.Ae||(e.Ae=iJ(e,e.explicitOrderBy)),e.Ae}function iJ(e,t){if("F"===e.limitType)return iV(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ib(e.field,t)});let r=e.endAt?new iy(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new iy(e.startAt.position,e.startAt.inclusive):null;return iV(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function iZ(e,t){let r=e.filters.concat([t]);return new iK(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function i0(e,t,r){return new iK(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function i1(e,t){return iU(iX(e),iX(t))&&e.limitType===t.limitType}function i2(e){return`${iB(iX(e))}|lt:${e.limitType}`}function i6(e){var t;let r;return`Query(target=${r=(t=iX(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof iI?`${t.field.canonicalString()} ${t.op} ${ie(t.value)}`:t instanceof i_?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rC(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>ie(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>ie(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function i3(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):t8.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of iW(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=iv(i,iW(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=iv(s,iW(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function i5(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function i4(e){return(t,r)=>{let n=!1;for(let i of iW(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?t8.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?n8(i,s):tR(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return tR(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class i8{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){nS(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return nC(this.inner)}size(){return this.innerSize}}let i7=new nA(t8.comparator),i9=new nA(t8.comparator);function se(...e){let t=i9;for(let r of e)t=t.insert(r.key,r);return t}function st(e){let t=i9;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function sr(){return new i8(e=>e.toString(),(e,t)=>e.isEqual(t))}let sn=new nA(t8.comparator),si=new nN(t8.comparator);function ss(...e){let t=si;for(let r of e)t=t.add(r);return t}let sa=new nN(tX);function so(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rA(t)?"-0":t}}function sl(e){return{integerValue:""+e}}function su(e,t){return rD(t)?sl(t):so(e,t)}class sh{constructor(){this._=void 0}}function sc(e,t){return e instanceof sy?ir(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sd extends sh{}class sf extends sh{constructor(e){super(),this.elements=e}}function sp(e,t){let r=sw(t);for(let t of e.elements)r.some(e=>n5(e,t))||r.push(t);return{arrayValue:{values:r}}}class sg extends sh{constructor(e){super(),this.elements=e}}function sm(e,t){let r=sw(t);for(let t of e.elements)r=r.filter(e=>!n5(e,t));return{arrayValue:{values:r}}}class sy extends sh{constructor(e,t){super(),this.serializer=e,this.Re=t}}function sv(e){return nU(e.integerValue||e.doubleValue)}function sw(e){return ii(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sb{constructor(e,t){this.field=e,this.transform=t}}class sE{constructor(e,t){this.version=e,this.transformResults=t}}class sI{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sI}static exists(e){return new sI(void 0,e)}static updateTime(e){return new sI(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s_(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sT{}function sS(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sO(e.key,sI.none()):new sA(e.key,e.data,sI.none());{let r=e.data,n=ig.empty(),i=new nN(t4.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new sD(e.key,n,new nM(i.toArray()),sI.none())}}function sx(e,t,r,n){return e instanceof sA?function(e,t,r,n){if(!s_(e.precondition,t))return r;let i=e.value.clone(),s=sR(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof sD?function(e,t,r,n){if(!s_(e.precondition,t))return r;let i=sR(e.fieldTransforms,n,t),s=t.data;return(s.setAll(sk(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):s_(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function sC(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&tZ(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof sf&&n instanceof sf||r instanceof sg&&n instanceof sg?tZ(r.elements,n.elements,n5):r instanceof sy&&n instanceof sy?n5(r.Re,n.Re):r instanceof sd&&n instanceof sd)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sA extends sT{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class sD extends sT{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sk(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function sN(e,t,r){let n=new Map;tM(e.length===r.length,32656,{Ve:r.length,me:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof sf?sp(o,l):o instanceof sg?sm(o,l):i))}return n}function sR(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof sd?(n=t,i={fields:{[nj]:{stringValue:nz},[nK]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&nG(n)&&(n=nQ(n)),n&&(i.fields[n$]=n),{mapValue:i}):e instanceof sf?sp(e,t):e instanceof sg?sm(e,t):(a=sv(s=sc(e,t))+sv(e.Re),ir(s)&&ir(e.Re)?sl(a):so(e.serializer,a))}(e,s,t))}return n}class sO extends sT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sM extends sT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sL{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof sA?(n=e.value.clone(),i=sN(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof sD?function(e,t,r){if(!s_(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=sN(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(sk(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=sx(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=sx(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sr();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sS(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(t1.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ss())}isEqual(e){return this.batchId===e.batchId&&tZ(this.mutations,e.mutations,(e,t)=>sC(e,t))&&tZ(this.baseMutations,e.baseMutations,(e,t)=>sC(e,t))}}class sP{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tM(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let n=sn,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new sP(e,t,r,n)}}class sF{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class sV{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class sB{constructor(e,t){this.count=e,this.unchangedNames=t}}function sU(e){switch(e){case tP.OK:return tR(64938);case tP.CANCELLED:case tP.UNKNOWN:case tP.DEADLINE_EXCEEDED:case tP.RESOURCE_EXHAUSTED:case tP.INTERNAL:case tP.UNAVAILABLE:case tP.UNAUTHENTICATED:return!1;case tP.INVALID_ARGUMENT:case tP.NOT_FOUND:case tP.ALREADY_EXISTS:case tP.PERMISSION_DENIED:case tP.FAILED_PRECONDITION:case tP.ABORTED:case tP.OUT_OF_RANGE:case tP.UNIMPLEMENTED:case tP.DATA_LOSS:return!0;default:return tR(15467,{code:e})}}function sq(e){if(void 0===e)return tD("GRPC error has no .code"),tP.UNKNOWN;switch(e){case m.OK:return tP.OK;case m.CANCELLED:return tP.CANCELLED;case m.UNKNOWN:return tP.UNKNOWN;case m.DEADLINE_EXCEEDED:return tP.DEADLINE_EXCEEDED;case m.RESOURCE_EXHAUSTED:return tP.RESOURCE_EXHAUSTED;case m.INTERNAL:return tP.INTERNAL;case m.UNAVAILABLE:return tP.UNAVAILABLE;case m.UNAUTHENTICATED:return tP.UNAUTHENTICATED;case m.INVALID_ARGUMENT:return tP.INVALID_ARGUMENT;case m.NOT_FOUND:return tP.NOT_FOUND;case m.ALREADY_EXISTS:return tP.ALREADY_EXISTS;case m.PERMISSION_DENIED:return tP.PERMISSION_DENIED;case m.FAILED_PRECONDITION:return tP.FAILED_PRECONDITION;case m.ABORTED:return tP.ABORTED;case m.OUT_OF_RANGE:return tP.OUT_OF_RANGE;case m.UNIMPLEMENTED:return tP.UNIMPLEMENTED;case m.DATA_LOSS:return tP.DATA_LOSS;default:return tR(39323,{code:e})}}(y=m||(m={}))[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS";let sz=null,sj=new a([0xffffffff,0xffffffff],0);function s$(e){let t=tH().encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function sK(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class sG{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new sQ(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new sQ(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new sQ(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=a.fromNumber(this.pe)}we(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(sj)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,r]=sK(s$(e));for(let e=0;e<this.hashCount;e++){let n=this.we(t,r,e);if(!this.be(n))return!1}return!0}static create(e,t,r){let n=new sG(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.pe)return;let[t,r]=sK(s$(e));for(let e=0;e<this.hashCount;e++){let n=this.we(t,r,e);this.Se(n)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class sQ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sH{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,sW.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new sH(t1.min(),n,new nA(tX),i7,ss())}}class sW{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new sW(r,t,ss(),ss(),ss())}}class sX{constructor(e,t,r,n){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=n}}class sY{constructor(e,t){this.targetId=e,this.Ce=t}}class sJ{constructor(e,t,r=nF.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class sZ{constructor(){this.Fe=0,this.Me=s2(),this.xe=nF.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=ss(),t=ss(),r=ss();return this.Me.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:tR(38017,{changeType:i})}}),new sW(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=s2()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,tM(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class s0{constructor(e){this.ze=e,this.je=new Map,this.He=i7,this.Je=s1(),this.Ye=s1(),this.Ze=new nA(tX)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:tR(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,r)=>{this.it(r)&&t(r)})}ot(e){let t=e.targetId,r=e.Ce.count,n=this._t(t);if(n){let d=n.target;if(iq(d))if(0===r){let e=new t8(d.path);this.tt(t,e,im.newNoDocument(e,t1.min()))}else tM(1===r,20013,{expectedCount:r});else{let n=this.ut(t);if(n!==r){var i,s,a,o,l,u,h,c;let r,d,f=this.ct(e),p=f?this.lt(f,e,n):1;0!==p&&(this.st(t),this.Ze=this.Ze.insert(t,2===p?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==sz||sz.ht((i=e.Ce,s=this.ze.Pt(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(d=i.unchangedNames)&&(r.bloomFilter={applied:0===p,hashCount:null!=(a=null==d?void 0:d.hashCount)?a:0,bitmapLength:null!=(u=null==(l=null==(o=null==d?void 0:d.bits)?void 0:o.bitmap)?void 0:l.length)?u:0,padding:null!=(c=null==(h=null==d?void 0:d.bits)?void 0:h.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==f?void 0:f.mightContain(e))&&t}}),r))}}}}ct(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=nq(i).toUint8Array()}catch(e){if(e instanceof nL)return tk("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new sG(t,s,a)}catch(e){return tk(e instanceof sQ?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.pe?null:r}lt(e,t,r){return 2*(t.Ce.count!==r-this.Tt(e,t.targetId))}Tt(e,t){let r=this.ze.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,r,null),n++)}),n}It(e){let t=new Map;this.je.forEach((r,n)=>{let i=this._t(n);if(i){if(r.current&&iq(i.target)){let t=new t8(i.target.path);this.Et(t).has(n)||this.dt(n,t)||this.tt(n,t,im.newNoDocument(t,e))}r.Le&&(t.set(n,r.qe()),r.Qe())}});let r=ss();this.Ye.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.He.forEach((t,r)=>r.setReadTime(e));let n=new sH(e,t,this.Ze,this.He,r);return this.He=i7,this.Je=s1(),this.Ye=s1(),this.Ze=new nA(tX),n}et(e,t){if(!this.it(e))return;let r=2*!!this.dt(e,t.key);this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;let n=this.rt(e);this.dt(e,t)?n.$e(t,1):n.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new sZ,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new nN(tX),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new nN(tX),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||tA("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new sZ),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function s1(){return new nA(t8.comparator)}function s2(){return new nA(t8.comparator)}let s6={asc:"ASCENDING",desc:"DESCENDING"},s3={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},s5={and:"AND",or:"OR"};class s4{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function s8(e,t){return e.useProto3Json||rC(t)?t:{value:t}}function s7(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function s9(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ae(e){let t;return tM(!!e,49232),t1.fromTimestamp(new t0((t=nB(e)).seconds,t.nanos))}function at(e,t){return ar(e,t).canonicalString()}function ar(e,t){let r=new t3(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function an(e){let t=t3.fromString(e);return tM(ab(t),10190,{key:t.toString()}),t}function ai(e,t){return at(e.databaseId,t.path)}function as(e,t){let r=an(t);if(r.get(1)!==e.databaseId.projectId)throw new tF(tP.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new tF(tP.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new t8(au(r))}function aa(e,t){return at(e.databaseId,t)}function ao(e){let t=an(e);return 4===t.length?t3.emptyPath():au(t)}function al(e){return new t3(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function au(e){return tM(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ah(e,t,r){return{name:ai(e,t),fields:r.value.mapValue.fields}}function ac(e,t,r){let n=as(e,t.name),i=ae(t.updateTime),s=t.createTime?ae(t.createTime):t1.min(),a=new ig({mapValue:{fields:t.fields}}),o=im.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function ad(e,t){var r,n;let i;if(t instanceof sA)i={update:ah(e,t.key,t.value)};else if(t instanceof sO)i={delete:ai(e,t.key)};else if(t instanceof sD){let r;i={update:ah(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof sM))return tR(16599,{ft:t.type});i={verify:ai(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof sd)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof sf)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof sg)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof sy)return{fieldPath:t.field.canonicalString(),increment:r.Re};throw tR(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:s7(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:tR(27497)),i}function af(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?sI.updateTime(ae(r.updateTime)):void 0!==r.exists?sI.exists(r.exists):sI.none():sI.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(tM("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new sd):"appendMissingElements"in t?r=new sf(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new sg(t.removeAllFromArray.values||[]):"increment"in t?r=new sy(e,t.increment):tR(16584,{proto:t}),new sb(t4.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=as(e,t.update.name),s=new ig({mapValue:{fields:t.update.fields}});return t.updateMask?new sD(r,s,new nM((t.updateMask.fieldPaths||[]).map(e=>t4.fromServerFormat(e))),n,i):new sA(r,s,n,i)}return t.delete?new sO(as(e,t.delete),n):t.verify?new sM(as(e,t.verify),n):tR(1463,{proto:t})}function ap(e,t){return{documents:[aa(e,t.path)]}}function ag(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=aa(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof iI?function(e){if("=="===e.op){if(ia(e.value))return{unaryFilter:{field:av(e.field),op:"IS_NAN"}};if(is(e.value))return{unaryFilter:{field:av(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ia(e.value))return{unaryFilter:{field:av(e.field),op:"IS_NOT_NAN"}};if(is(e.value))return{unaryFilter:{field:av(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:av(e.field),op:s3[e.op],value:e.value}}}(t):t instanceof i_?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:s5[r.op],filters:n}}:tR(54877,{filter:t})}(i_.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:av(e.field),direction:s6[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=s8(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{gt:s,parent:i}}function am(e,t,r,n){let{gt:i,parent:s}=ag(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:av(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:av(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},yt:a,parent:s}}function ay(e){var t,r,n;let i,s,a,o,l=ao(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){tM(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aw(e.unaryFilter.field);return iI.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=aw(e.unaryFilter.field);return iI.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=aw(e.unaryFilter.field);return iI.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aw(e.unaryFilter.field);return iI.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tR(61313);default:return tR(60726)}}(t):void 0!==t.fieldFilter?iI.create(aw(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tR(58110);default:return tR(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?i_.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tR(1026)}}(t.compositeFilter.op)):tR(30097,{filter:t})}(u.where))instanceof i_&&ix(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new ib(aw(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=rC(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(r=u.startAt).before,g=new iy(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new iy(n.values||[],o)),new iK(l,c,f,d,p,"F",g,m)}function av(e){return{fieldPath:e.canonicalString()}}function aw(e){return t4.fromServerFormat(e.fieldPath)}function ab(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aE{constructor(e,t,r,n,i=t1.min(),s=t1.min(),a=nF.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new aE(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aE(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aE(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aE(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aI{constructor(e){this.wt=e}}function a_(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:aT(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:ai(i=e.wt,t.key),fields:t.data.value.mapValue.fields,updateTime:s7(i,t.version.toTimestamp()),createTime:s7(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:aS(t.version)};else{if(!t.isUnknownDocument())return tR(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:aS(t.version)}}return n}function aT(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function aS(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ax(e){let t=new t0(e.seconds,e.nanoseconds);return t1.fromTimestamp(t)}function aC(e,t){let r=(t.baseMutations||[]).map(t=>af(e.wt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>af(e.wt,t)),i=t0.fromMillis(t.localWriteTimeMs);return new sL(t.batchId,i,r,n)}function aA(e){var t;let r,n=ax(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ax(e.lastLimboFreeSnapshotVersion):t1.min();return new aE(void 0!==e.query.documents?(tM(1===(r=(t=e.query).documents.length),1966,{count:r}),iX(iG(ao(t.documents[0])))):iX(ay(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,nF.fromBase64String(e.resumeToken))}function aD(e,t){let r,n=aS(t.snapshotVersion),i=aS(t.lastLimboFreeSnapshotVersion);r=iq(t.target)?ap(e.wt,t.target):ag(e.wt,t.target).gt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:iB(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ak(e){let t=ay({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?i0(t,t.limit,"L"):t}function aN(e,t){return new sF(t.largestBatchId,af(e.wt,t.overlayMutation))}function aR(e,t){let r=t.path.lastSegment();return[e,rk(t.path.popLast()),r]}function aO(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:aS(n.readTime),documentKey:rk(n.documentKey.path),largestBatchId:n.largestBatchId}}class aM{getBundleMetadata(e,t){return n_(e,r7).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:ax(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return n_(e,r7).put({bundleId:t.id,createTime:aS(ae(t.createTime)),version:t.version})}getNamedQuery(e,t){return n_(e,r9).get(t).next(e=>{if(e)return{name:e.name,query:ak(e.bundledQuery),readTime:ax(e.readTime)}})}saveNamedQuery(e,t){return n_(e,r9).put({name:t.name,readTime:aS(ae(t.readTime)),bundledQuery:t.bundledQuery})}}class aL{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){return new aL(e,t.uid||"")}getOverlay(e,t){return n_(e,nh).get(aR(this.userId,t)).next(e=>e?aN(this.serializer,e):null)}getOverlays(e,t){let r=sr();return rc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new sF(t,i);n.push(this.St(e,s))}),rc.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(rk(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(n_(e,nh).X(nd,n))}),rc.waitFor(i)}getOverlaysForCollection(e,t,r){let n=sr(),i=rk(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return n_(e,nh).J(nd,s).next(e=>{for(let t of e){let e=aN(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=sr(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return n_(e,nh).te({index:np,range:a},(e,t,r)=>{let a=aN(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}St(e,t){return n_(e,nh).put(function(e,t,r){let[n,i,s]=aR(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:ad(e.wt,r.mutation)}}(this.serializer,this.userId,t))}}class aP{Dt(e){return n_(e,nm)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?nF.fromUint8Array(t):nF.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class aF{vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(nU(e.integerValue));else if("doubleValue"in e){let r=nU(e.doubleValue);isNaN(r)?this.Mt(t,13):(this.Mt(t,15),rA(r)?t.xt(0):t.xt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Mt(t,20),"string"==typeof r&&(r=nB(r)),t.Ot(`${r.seconds||""}`),t.xt(r.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(nq(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Mt(t,45),t.xt(r.latitude||0),t.xt(r.longitude||0)}else"mapValue"in e?ih(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):il(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):tR(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let r=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(r)))this.Nt(e,t),this.Ct(r[e],t)}qt(e,t){var r,n;let i=e.fields||{};this.Mt(t,53);let s=(null==(n=null==(r=i[n2].arrayValue)?void 0:r.values)?void 0:n.length)||0;this.Mt(t,15),t.xt(nU(s)),this.Nt(n2,t),this.Ct(i[n2],t)}$t(e,t){let r=e.values||[];for(let e of(this.Mt(t,50),r))this.Ct(e,t)}kt(e,t){this.Mt(t,37),t8.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}function aV(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}aF.Wt=new aF;class aB{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.zt(r.value),r=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Yt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{let e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){let t=this.tn(e),r=aV(t);this.nn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}rn(e){let t=this.tn(e),r=aV(t);this.nn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}sn(){this._n(255),this._n(255)}an(){this.un(255),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}zt(e){let t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(t)}Jt(e){let t=255&e;0===t?(this.un(0),this.un(255)):255===t?(this.un(255),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class aU{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class aq{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class az{constructor(){this.ln=new aB,this.hn=new aU(this.ln),this.Pn=new aq(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class aj{constructor(e,t,r,n){this.In=e,this.En=t,this.dn=r,this.An=n}Rn(){let e=this.An.length,t=0===e||255===this.An[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.An,0),t!==e?r.set([0],this.An.length):++r[r.length-1],new aj(this.In,this.En,this.dn,r)}Vn(e,t,r){return{indexId:this.In,uid:e,arrayValue:aG(this.dn),directionalValue:aG(this.An),orderedDocumentKey:aG(t),documentKey:r.path.toArray()}}mn(e,t,r){let n=this.Vn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function a$(e,t){let r=e.In-t.In;return 0!==r||0!==(r=aK(e.dn,t.dn))||0!==(r=aK(e.An,t.An))?r:t8.comparator(e.En,t.En)}function aK(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function aG(e){return J()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function aQ(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class aH{constructor(e){for(const t of(this.fn=new nN((e,t)=>t4.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.gn=e.orderBy,this.pn=[],e.filters))t.isInequality()?this.fn=this.fn.add(t):this.pn.push(t)}get yn(){return this.fn.size>1}wn(e){if(tM(e.collectionGroup===this.collectionId,49279),this.yn)return!1;let t=t9(e);if(void 0!==t&&!this.bn(t))return!1;let r=re(e),n=new Set,i=0,s=0;for(;i<r.length&&this.bn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.fn.size>0){let e=this.fn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.Sn(e,t)||!this.Dn(this.gn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.gn.length||!this.Dn(this.gn[s++],e))return!1}return!0}vn(){if(this.yn)return null;let e=new nN(t4.comparator),t=[];for(let r of this.pn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new rr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new rr(r.field,0))}for(let r of this.gn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new rr(r.field,+("asc"!==r.dir))));return new t7(t7.UNKNOWN_ID,this.collectionId,t,rn.empty())}bn(e){for(let t of this.pn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}Dn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function aW(e){return e instanceof iI}function aX(e){return e instanceof i_&&ix(e)}function aY(e){return aW(e)||aX(e)||function(e){if(e instanceof i_&&iS(e)){for(let t of e.getFilters())if(!aW(t)&&!aX(t))return!1;return!0}return!1}(e)}function aJ(e,t){return tM(e instanceof iI||e instanceof i_,38388),tM(t instanceof iI||t instanceof i_,25473),a0(e instanceof iI?t instanceof iI?i_.create([e,t],"and"):aZ(e,t):t instanceof iI?aZ(t,e):function(e,t){if(tM(e.filters.length>0&&t.filters.length>0,48005),iT(e)&&iT(t))return iA(e,t.getFilters());let r=iS(e)?e:t,n=iS(e)?t:e,i=r.filters.map(e=>aJ(e,n));return i_.create(i,"or")}(e,t))}function aZ(e,t){if(iT(t))return iA(t,e.getFilters());{let r=t.filters.map(t=>aJ(e,t));return i_.create(r,"or")}}function a0(e){if(tM(e instanceof iI||e instanceof i_,11850),e instanceof iI)return e;let t=e.getFilters();if(1===t.length)return a0(t[0]);if(iC(e))return e;let r=t.map(e=>a0(e)),n=[];return r.forEach(t=>{t instanceof iI?n.push(t):t instanceof i_&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:i_.create(n,e.op)}class a1{constructor(){this.Cn=new a2}addToCollectionParentIndex(e,t){return this.Cn.add(t),rc.resolve()}getCollectionParents(e,t){return rc.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return rc.resolve()}deleteFieldIndex(e,t){return rc.resolve()}deleteAllFieldIndexes(e){return rc.resolve()}createTargetIndexes(e,t){return rc.resolve()}getDocumentsMatchingTarget(e,t){return rc.resolve(null)}getIndexType(e,t){return rc.resolve(0)}getFieldIndexes(e,t){return rc.resolve([])}getNextCollectionGroupToUpdate(e){return rc.resolve(null)}getMinOffset(e,t){return rc.resolve(ra.min())}getMinOffsetFromCollectionGroup(e,t){return rc.resolve(ra.min())}updateCollectionGroup(e,t,r){return rc.resolve()}updateIndexEntries(e,t){return rc.resolve()}}class a2{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new nN(t3.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new nN(t3.comparator)).toArray()}}let a6="IndexedDbIndexManager",a3=new Uint8Array(0);class a5{constructor(e,t){this.databaseId=t,this.Fn=new a2,this.Mn=new i8(e=>iB(e),(e,t)=>iU(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Fn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Fn.add(t)});let i={collectionId:r,parent:rk(n)};return n_(e,r5).put(i)}return rc.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return n_(e,r5).J(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(rN(n.parent))}return r})}addFieldIndex(e,t){let r=n_(e,ne),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=n_(e,nr);return i.next(e=>{r.put(aO(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=n_(e,ne),n=n_(e,nr),i=n_(e,na);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=n_(e,ne),r=n_(e,na),n=n_(e,nr);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return rc.forEach(this.xn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new aH(t).vn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=n_(e,na),n=!0,i=new Map;return rc.forEach(this.xn(t),t=>this.On(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=ss(),n=[];return rc.forEach(i,(i,s)=>{tA(a6,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${iB(t)}`);let a=function(e,t){let r=t9(t);if(void 0===r)return null;for(let t of iz(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of re(t))for(let t of iz(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of re(t)){let t=0===i.kind?ij(e,i.fieldPath,e.startAt):i$(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new iy(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of re(t)){let t=0===i.kind?i$(e,i.fieldPath,e.endAt):ij(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new iy(r,n)}(s,i),h=this.Nn(i,s,l),c=this.Nn(i,s,u),d=this.Bn(i,s,o),f=this.Ln(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return rc.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=t8.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return rc.resolve(null)})}xn(e){let t=this.Mn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(tM(t instanceof iI||t instanceof i_,34018),t instanceof iI)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=i_.create(r,t.op);return aY(n=a0(n))?n:(tM(n instanceof i_,64498),tM(iT(n),40251),tM(n.filters.length>1,57927),n.filters.reduce((e,t)=>aJ(e,t)))}(function e(t){var r,n;if(tM(t instanceof iI||t instanceof i_,20012),t instanceof iI){if(t instanceof iM){let e=(null==(n=null==(r=t.value.arrayValue)?void 0:r.values)?void 0:n.map(e=>iI.create(t.field,"==",e)))||[];return i_.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return i_.create(i,t.op)}(e));return tM(aY(t),7391),aW(t)||aX(t)?[t]:t.getFilters()})(i_.create(e.filters,"and")).map(t=>iV(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Mn.set(e,t)),t}Ln(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.kn(t[h/l]):a3,c=this.qn(e,o,r[h%l],n),d=this.Qn(e,o,i[h%l],s),f=a.map(t=>this.qn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}qn(e,t,r,n){let i=new aj(e,t8.empty(),t,r);return n?i:i.Rn()}Qn(e,t,r,n){let i=new aj(e,t8.empty(),t,r);return n?i.Rn():i}On(e,t){let r=new aH(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.wn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.xn(t);return rc.forEach(n,t=>this.On(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new nN(t4.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}$n(e,t){let r=new az;for(let n of re(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.Tn(n.kind);aF.Wt.vt(e,i)}return r.cn()}kn(e){let t=new az;return aF.Wt.vt(e,t.Tn(0)),t.cn()}Un(e,t){let r,n=new az;return aF.Wt.vt(it(this.databaseId,t),n.Tn(0===(r=re(e)).length?0:r[r.length-1].kind)),n.cn()}Bn(e,t,r){if(null===r)return[];let n=[];n.push(new az);let i=0;for(let s of re(e)){let e=r[i++];for(let r of n)if(this.Kn(t,s.fieldPath)&&ii(e))n=this.Wn(n,s,e);else{let t=r.Tn(s.kind);aF.Wt.vt(e,t)}}return this.Gn(n)}Nn(e,t,r){return this.Bn(e,t,r.position)}Gn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].cn();return t}Wn(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new az;n.seed(r.cn()),aF.Wt.vt(e,n.Tn(t.kind)),i.push(n)}return i}Kn(e,t){return!!e.filters.find(e=>e instanceof iI&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=n_(e,ne),n=n_(e,nr);return(t?r.J(nt,IDBKeyRange.bound(t,t)):r.J()).next(e=>{let t=[];return rc.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new rn(r.sequenceNumber,new ra(ax(r.readTime),new t8(rN(r.documentKey)),r.largestBatchId)):rn.empty(),i=e.fields.map(([e,t])=>new rr(t4.fromServerFormat(e),t)),new t7(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:tX(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=n_(e,ne),i=n_(e,nr);return this.zn(e).next(e=>n.J(nt,IDBKeyRange.bound(t,t)).next(t=>rc.forEach(t,t=>i.put(aO(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return rc.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?rc.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),rc.forEach(i,r=>this.jn(e,t,r).next(t=>{let i=this.Hn(n,r);return t.isEqual(i)?rc.resolve():this.Jn(e,n,r,t,i)}))))})}Yn(e,t,r,n){return n_(e,na).put(n.Vn(this.uid,this.Un(r,t.key),t.key))}Zn(e,t,r,n){return n_(e,na).delete(n.mn(this.uid,this.Un(r,t.key),t.key))}jn(e,t,r){let n=n_(e,na),i=new nN(a$);return n.te({index:nl,range:IDBKeyRange.only([r.indexId,this.uid,aG(this.Un(r,t))])},(e,n)=>{i=i.add(new aj(r.indexId,t,aQ(n.arrayValue),aQ(n.directionalValue)))}).next(()=>i)}Hn(e,t){let r=new nN(a$),n=this.$n(t,e);if(null==n)return r;let i=t9(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ii(s))for(let i of s.arrayValue.values||[])r=r.add(new aj(t.indexId,e.key,this.kn(i),n))}else r=r.add(new aj(t.indexId,e.key,a3,n));return r}Jn(e,t,r,n,i){tA(a6,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=nO(s),l=nO(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=nO(a)):t?(i(o),o=nO(s)):(o=nO(s),l=nO(a))}}(n,i,a$,n=>{s.push(this.Yn(e,t,r,n))},n=>{s.push(this.Zn(e,t,r,n))}),rc.waitFor(s)}zn(e){let t=1;return n_(e,nr).te({index:ni,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>a$(e,t)).filter((e,t,r)=>!t||0!==a$(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=a$(i,e),s=a$(i,t);if(0===r)n[0]=e.Rn();else if(r>0&&s<0)n.push(i),n.push(i.Rn());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Xn(n[e],n[e+1]))return[];let t=n[e].mn(this.uid,a3,t8.empty()),r=n[e+1].mn(this.uid,a3,t8.empty());i.push(IDBKeyRange.bound(t,r))}return i}Xn(e,t){return a$(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(a4)}getMinOffset(e,t){return rc.mapArray(this.xn(t),t=>this.On(e,t).next(e=>e||tR(44426))).next(a4)}}function a4(e){tM(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>ro(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new ra(t.readTime,t.documentKey,r)}let a8={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class a7{static withCacheSize(e){return new a7(e,a7.DEFAULT_COLLECTION_PERCENTILE,a7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function a9(e,t,r){let n=e.store(rP),i=e.store(rq),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.te({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{tM(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,rk(h),c]);s.push(i.delete(n)),u.push(e.key)}return rc.waitFor(s).next(()=>u)}function oe(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw tR(14731);t=e.noDocument}return JSON.stringify(t).length}a7.DEFAULT_COLLECTION_PERCENTILE=10,a7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,a7.DEFAULT=new a7(0x2800000,a7.DEFAULT_COLLECTION_PERCENTILE,a7.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),a7.DISABLED=new a7(-1,0,0);class ot{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.er={}}static bt(e,t,r,n){return tM(""!==e.uid,64387),new ot(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return on(e).te({index:rV,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=n_(e,rq),s=on(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;tM("number"==typeof a,49019);let f=new sL(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>ad(o.wt,e)),d=f.mutations.map(e=>ad(o.wt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new nN((e,t)=>tX(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,rk(h),a]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,rU))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.er[a]=f.keys()}),rc.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return on(e).get(t).next(e=>e?(tM(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),aC(this.serializer,e)):null)}tr(e,t){return this.er[t]?rc.resolve(this.er[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.er[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return on(e).te({index:rV,range:n},(e,t,n)=>{t.userId===this.userId&&(tM(t.batchId>=r,47524,{nr:r}),i=aC(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return on(e).te({index:rV,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return on(e).J(rV,t).next(e=>e.map(e=>aC(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,rk(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return n_(e,rq).te({range:n},(r,n,s)=>{let[a,o,l]=r,u=rN(o);if(a===this.userId&&t.path.isEqual(u))return on(e).get(l).next(e=>{if(!e)throw tR(61480,{rr:r,batchId:l});tM(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(aC(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nN(tX),n=[];return t.forEach(t=>{let i=[this.userId,rk(t.path)],s=IDBKeyRange.lowerBound(i),a=n_(e,rq).te({range:s},(e,n,i)=>{let[s,a,o]=e,l=rN(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),rc.waitFor(n).next(()=>this.ir(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,rk(r)],s=IDBKeyRange.lowerBound(i),a=new nN(tX);return n_(e,rq).te({range:s},(e,t,i)=>{let[s,o,l]=e,u=rN(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.ir(e,a))}ir(e,t){let r=[],n=[];return t.forEach(t=>{n.push(on(e).get(t).next(e=>{if(null===e)throw tR(35274,{batchId:t});tM(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(aC(this.serializer,e))}))}),rc.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return a9(e.he,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.sr(t.batchId)}),rc.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}sr(e){delete this.er[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rc.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return n_(e,rq).te({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=rN(e[1]);n.push(t)}else r.done()}).next(()=>{tM(0===n.length,56720,{_r:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return or(e,this.userId,t)}ar(e){return n_(e,rL).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function or(e,t,r){let n=[t,rk(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return n_(e,rq).te({range:s,ee:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function on(e){return n_(e,rP)}class oi{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new oi(0)}static lr(){return new oi(-1)}}class os{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.hr(e).next(t=>{let r=new oi(t.highestTargetId);return t.highestTargetId=r.next(),this.Pr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.hr(e).next(e=>t1.fromTimestamp(new t0(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.hr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.hr(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.Pr(e,n)))}addTargetData(e,t){return this.Tr(e,t).next(()=>this.hr(e).next(r=>(r.targetCount+=1,this.Ir(t,r),this.Pr(e,r))))}updateTargetData(e,t){return this.Tr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>n_(e,rX).delete(t.targetId)).next(()=>this.hr(e)).next(t=>(tM(t.targetCount>0,8065),t.targetCount-=1,this.Pr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return n_(e,rX).te((s,a)=>{let o=aA(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>rc.waitFor(i)).next(()=>n)}forEachTarget(e,t){return n_(e,rX).te((e,r)=>{t(aA(r))})}hr(e){return n_(e,r3).get(r6).next(e=>(tM(null!==e,2888),e))}Pr(e,t){return n_(e,r3).put(r6,t)}Tr(e,t){return n_(e,rX).put(aD(this.serializer,t))}Ir(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.hr(e).next(e=>e.targetCount)}getTargetData(e,t){let r=iB(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return n_(e,rX).te({range:n,index:rY},(e,r,n)=>{let s=aA(r);iU(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=oa(e);return t.forEach(t=>{let s=rk(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),rc.waitFor(n)}removeMatchingKeys(e,t,r){let n=oa(e);return rc.forEach(t,t=>{let i=rk(t.path);return rc.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=oa(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=oa(e),i=ss();return n.te({range:r,ee:!0},(e,t,r)=>{let n=new t8(rN(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=rk(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return oa(e).te({index:r1,ee:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}Rt(e,t){return n_(e,rX).get(t).next(e=>e?aA(e):null)}}function oa(e){return n_(e,rZ)}let oo="LruGarbageCollector";function ol([e,t],[r,n]){let i=tX(e,r);return 0===i?tX(t,n):i}class ou{constructor(e){this.Er=e,this.buffer=new nN(ol),this.dr=0}Ar(){return++this.dr}Rr(e){let t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>ol(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oh{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){tA(oo,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rv(e)?tA(oo,"Ignoring IndexedDB error during garbage collection: ",e):await rh(e)}await this.mr(3e5)})}}class oc{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rc.resolve(rx.le);let r=new ou(t);return this.gr.forEachTarget(e,e=>r.Rr(e.sequenceNumber)).next(()=>this.gr.yr(e,e=>r.Rr(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.gr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tA("LruGarbageCollector","Garbage collection skipped; disabled"),rc.resolve(a8)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tA("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a8):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let r,n,i,a,o,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tA("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),tx()<=s.DEBUG&&tA("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${n} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),rc.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class od{constructor(e,t){this.db=e,this.garbageCollector=new oc(this,t)}pr(e){let t=this.br(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}br(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}yr(e,t){return this.Sr(e,(e,r)=>t(r))}addReference(e,t,r){return of(e,r)}removeReference(e,t,r){return of(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return of(e,t)}Dr(e,t){let r;return r=!1,n_(e,rL).ne(n=>or(e,n,t).next(e=>(e&&(r=!0),rc.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.Sr(e,(s,a)=>{if(a<=t){let t=this.Dr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,t1.min()),oa(e).delete([0,rk(s.path)])))});n.push(t)}}).next(()=>rc.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return of(e,t)}Sr(e,t){let r=oa(e),n,i=rx.le;return r.te({index:r1},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==rx.le&&t(new t8(rN(n)),i),i=a,n=s):i=rx.le}).next(()=>{i!==rx.le&&t(new t8(rN(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function of(e,t){var r;return oa(e).put((r=e.currentSequenceNumber,{targetId:0,path:rk(t.path),sequenceNumber:r}))}class op{constructor(){this.changes=new i8(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,im.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?rc.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class og{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return n_(e,rz).put(r)}removeEntry(e,t,r){let n;return n_(e,rz).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],aT(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.vr(e,r)))}getEntry(e,t){let r=im.newInvalidDocument(t);return n_(e,rz).te({index:r$,range:IDBKeyRange.only(oy(t))},(e,n)=>{r=this.Cr(t,n)}).next(()=>r)}Fr(e,t){let r={size:0,document:im.newInvalidDocument(t)};return n_(e,rz).te({index:r$,range:IDBKeyRange.only(oy(t))},(e,n)=>{r={document:this.Cr(t,n),size:oe(n)}}).next(()=>r)}getEntries(e,t){let r=i7;return this.Mr(e,t,(e,t)=>{let n=this.Cr(e,t);r=r.insert(e,n)}).next(()=>r)}Or(e,t){let r=i7,n=new nA(t8.comparator);return this.Mr(e,t,(e,t)=>{let i=this.Cr(e,t);r=r.insert(e,i),n=n.insert(e,oe(t))}).next(()=>({documents:r,Nr:n}))}Mr(e,t,r){if(t.isEmpty())return rc.resolve();let n=new nN(ow);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(oy(n.first()),oy(n.last())),s=n.getIterator(),a=s.getNext();return n_(e,rz).te({index:r$,range:i},(e,t,n)=>{let i=t8.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>ow(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.H(oy(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),aT(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return n_(e,rz).J(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let r=i7;for(let i of e){let e=this.Cr(t8.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(i3(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=i7,s=ov(t,r),a=ov(t,ra.max());return n_(e,rz).te({index:rG,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Cr(t8.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new om(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return n_(e,rH).get(rW).next(e=>(tM(!!e,20021),e))}vr(e,t){return n_(e,rH).put(rW,t)}Cr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=ac(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=t8.fromSegments(t.noDocument.path),r=ax(t.noDocument.readTime);n=im.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return tR(56709);{let e=t8.fromSegments(t.unknownDocument.path),r=ax(t.unknownDocument.version);n=im.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new t0((r=t.readTime)[0],r[1]),t1.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(t1.min())))return e}return im.newInvalidDocument(e)}}class om extends op{constructor(e,t){super(),this.Br=e,this.trackRemovals=t,this.Lr=new i8(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new nN((e,t)=>tX(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Lr.get(i);if(t.push(this.Br.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=a_(this.Br.serializer,s);n=n.add(i.path.popLast());let l=oe(o);r+=l-a.size,t.push(this.Br.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=a_(this.Br.serializer,s.convertToNoDocument(t1.min()));t.push(this.Br.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Br.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Br.updateMetadata(e,r)),rc.waitFor(t)}getFromCache(e,t){return this.Br.Fr(e,t).next(e=>(this.Lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Br.Or(e,t).next(({documents:e,Nr:t})=>(t.forEach((t,r)=>{this.Lr.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function oy(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ov(e,t){let r=t.documentKey.path.toArray();return[e,aT(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function ow(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=tX(r[e],n[e]))return i;return(i=tX(r.length,n.length))||(i=tX(r[r.length-2],n[n.length-2]))||tX(r[r.length-1],n[n.length-1])}class ob{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oE{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sx(r.mutation,e,nM.empty(),t0.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,ss()).next(()=>t))}getLocalViewOfDocuments(e,t,r=ss()){let n=sr();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=se();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=sr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ss()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=i7,s=sr(),a=sr();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof sD)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sx(a.mutation,t,a.mutation.getFieldMask(),t0.now())):s.set(t.key,nM.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var r;return a.set(e,new ob(t,null!=(r=s.get(e))?r:null))}),a))}recalculateAndSaveOverlays(e,t){let r=sr(),n=new nA((e,t)=>e-t),i=ss();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||nM.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||ss()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=sr();l.forEach(e=>{if(!i.has(e)){let n=sS(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rc.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return t8.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):iH(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):rc.resolve(sr()),a=-1,o=i;return s.next(t=>rc.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?rc.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,ss())).next(e=>({batchId:a,changes:st(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new t8(t)).next(e=>{let t=se();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=se();return this.indexManager.getCollectionParents(e,i).next(a=>rc.forEach(a,a=>{let o=new iK(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,im.newInvalidDocument(n)))});let r=se();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&sx(s.mutation,n,nM.empty(),t0.now()),i3(t,n)&&(r=r.insert(e,n))}),r})}}class oI{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return rc.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,{id:t.id,version:t.version,createTime:ae(t.createTime)}),rc.resolve()}getNamedQuery(e,t){return rc.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,{name:t.name,query:ak(t.bundledQuery),readTime:ae(t.readTime)}),rc.resolve()}}class o_{constructor(){this.overlays=new nA(t8.comparator),this.Qr=new Map}getOverlay(e,t){return rc.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sr();return rc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.St(e,t,n)}),rc.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Qr.delete(r)),rc.resolve()}getOverlaysForCollection(e,t,r){let n=sr(),i=t.length+1,s=new t8(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return rc.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new nA((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=sr(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sr(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return rc.resolve(a)}St(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Qr.get(n.largestBatchId).delete(r.key);this.Qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new sF(t,r));let i=this.Qr.get(t);void 0===i&&(i=ss(),this.Qr.set(t,i)),this.Qr.set(t,i.add(r.key))}}class oT{constructor(){this.sessionToken=nF.EMPTY_BYTE_STRING}getSessionToken(e){return rc.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,rc.resolve()}}class oS{constructor(){this.$r=new nN(ox.Ur),this.Kr=new nN(ox.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let r=new ox(e,t);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.zr(new ox(e,t))}jr(e,t){e.forEach(e=>this.removeReference(e,t))}Hr(e){let t=new t8(new t3([])),r=new ox(t,e),n=new ox(t,e+1),i=[];return this.Kr.forEachInRange([r,n],e=>{this.zr(e),i.push(e.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new t8(new t3([])),r=new ox(t,e),n=new ox(t,e+1),i=ss();return this.Kr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new ox(e,0),r=this.$r.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ox{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return t8.comparator(e.key,t.key)||tX(e.Zr,t.Zr)}static Wr(e,t){return tX(e.Zr,t.Zr)||t8.comparator(e.key,t.key)}}class oC{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new nN(ox.Ur)}checkEmpty(e){return rc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sL(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Xr=this.Xr.add(new ox(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rc.resolve(s)}lookupMutationBatch(e,t){return rc.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.ti(t+1),n=r<0?0:r;return rc.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return rc.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return rc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ox(t,0),n=new ox(t,1/0),i=[];return this.Xr.forEachInRange([r,n],e=>{let t=this.ei(e.Zr);i.push(t)}),rc.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nN(tX);return t.forEach(e=>{let t=new ox(e,0),n=new ox(e,1/0);this.Xr.forEachInRange([t,n],e=>{r=r.add(e.Zr)})}),rc.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;t8.isDocumentKey(i)||(i=i.child(""));let s=new ox(new t8(i),0),a=new nN(tX);return this.Xr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Zr)),!0)},s),rc.resolve(this.ni(a))}ni(e){let t=[];return e.forEach(e=>{let r=this.ei(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tM(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Xr;return rc.forEach(t.mutations,n=>{let i=new ox(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Xr=r})}sr(e){}containsKey(e,t){let r=new ox(t,0),n=this.Xr.firstAfterOrEqual(r);return rc.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,rc.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class oA{constructor(e){this.ii=e,this.docs=new nA(t8.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ii(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return rc.resolve(r?r.document.mutableCopy():im.newInvalidDocument(t))}getEntries(e,t){let r=i7;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():im.newInvalidDocument(e))}),rc.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=i7,s=t.path,a=new t8(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=ro(rs(a),r)||(n.has(a.key)||i3(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rc.resolve(i)}getAllFromCollectionGroup(e,t,r,n){tR(9500)}si(e,t){return rc.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oD(this)}getSize(e){return rc.resolve(this.size)}}class oD extends op{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Br.addEntry(e,n)):this.Br.removeEntry(r)}),rc.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class ok{constructor(e){this.persistence=e,this.oi=new i8(e=>iB(e),iU),this.lastRemoteSnapshotVersion=t1.min(),this.highestTargetId=0,this._i=0,this.ai=new oS,this.targetCount=0,this.ui=oi.cr()}forEachTarget(e,t){return this.oi.forEach((e,r)=>t(r)),rc.resolve()}getLastRemoteSnapshotVersion(e){return rc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rc.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),rc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this._i&&(this._i=t),rc.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new oi(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,rc.resolve()}updateTargetData(e,t){return this.Tr(t),rc.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,rc.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.oi.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),rc.waitFor(i).next(()=>n)}getTargetCount(e){return rc.resolve(this.targetCount)}getTargetData(e,t){let r=this.oi.get(t)||null;return rc.resolve(r)}addMatchingKeys(e,t,r){return this.ai.Gr(t,r),rc.resolve()}removeMatchingKeys(e,t,r){this.ai.jr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),rc.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),rc.resolve()}getMatchingKeysForTargetId(e,t){let r=this.ai.Yr(t);return rc.resolve(r)}containsKey(e,t){return rc.resolve(this.ai.containsKey(t))}}class oN{constructor(e,t){this.ci={},this.overlays={},this.li=new rx(0),this.hi=!1,this.hi=!0,this.Pi=new oT,this.referenceDelegate=e(this),this.Ti=new ok(this),this.indexManager=new a1,this.remoteDocumentCache=new oA(e=>this.referenceDelegate.Ii(e)),this.serializer=new aI(t),this.Ei=new oI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ci[e.toKey()];return r||(r=new oC(t,this.referenceDelegate),this.ci[e.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,r){tA("MemoryPersistence","Starting transaction:",e);let n=new oR(this.li.next());return this.referenceDelegate.di(),r(n).next(e=>this.referenceDelegate.Ai(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ri(e,t){return rc.or(Object.values(this.ci).map(r=>()=>r.containsKey(e,t)))}}class oR extends ru{constructor(e){super(),this.currentSequenceNumber=e}}class oO{constructor(e){this.persistence=e,this.Vi=new oS,this.mi=null}static fi(e){return new oO(e)}get gi(){if(this.mi)return this.mi;throw tR(60996)}addReference(e,t,r){return this.Vi.addReference(r,t),this.gi.delete(r.toString()),rc.resolve()}removeReference(e,t,r){return this.Vi.removeReference(r,t),this.gi.add(r.toString()),rc.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),rc.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(e=>this.gi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.gi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rc.forEach(this.gi,r=>{let n=t8.fromPath(r);return this.pi(e,n).next(e=>{e||t.removeEntry(n,t1.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return rc.or([()=>rc.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class oM{constructor(e,t){this.persistence=e,this.yi=new i8(e=>rk(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oc(this,t)}static fi(e,t){return new oM(e,t)}di(){}Ai(e){return rc.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){let t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}br(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}yr(e,t){return rc.forEach(this.yi,(r,n)=>this.Dr(e,r,n).next(e=>e?rc.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.si(e,n=>this.Dr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,t1.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),rc.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),rc.resolve()}removeReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),rc.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),rc.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(n3(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=nQ(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return nq(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,nS(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw tR(13486,{value:t})}}(e.data.value)),t}Dr(e,t,r){return rc.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.yi.get(t);return rc.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class oL{constructor(e){this.serializer=e}q(e,t,r,n){let i=new rf("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(rO),e.createObjectStore(rL,{keyPath:"userId"}),e.createObjectStore(rP,{keyPath:rF,autoIncrement:!0}).createIndex(rV,rB,{unique:!0}),e.createObjectStore(rq),oP(e),e.createObjectStore(rR));let s=rc.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(rZ),e.deleteObjectStore(rX),e.deleteObjectStore(r3),oP(e)),s=s.next(()=>{let e,t;return e=i.store(r3),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:t1.min().toTimestamp(),targetCount:0},e.put(r6,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(rP).J().next(t=>{e.deleteObjectStore(rP),e.createObjectStore(rP,{keyPath:rF,autoIncrement:!0}).createIndex(rV,rB,{unique:!0});let r=i.store(rP),n=t.map(e=>r.put(e));return rc.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(r8,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.wi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(rH),this.bi(i)))),r<7&&n>=7&&(s=s.next(()=>this.Si(i))),r<8&&n>=8&&(s=s.next(()=>this.Di(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.Ci(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(r7,{keyPath:"bundleId"}),e.createObjectStore(r9,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(nh,{keyPath:nc})).createIndex(nd,nf,{unique:!1}),t.createIndex(np,ng,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(rz,{keyPath:rj})).createIndex(r$,rK),t.createIndex(rG,rQ)}).next(()=>this.Fi(e,i)).next(()=>e.deleteObjectStore(rR))),r<14&&n>=14&&(s=s.next(()=>this.Mi(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(ne,{keyPath:"indexId",autoIncrement:!0}).createIndex(nt,"collectionGroup",{unique:!1}),e.createObjectStore(nr,{keyPath:nn}).createIndex(ni,ns,{unique:!1}),e.createObjectStore(na,{keyPath:no}).createIndex(nl,nu,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(nr).clear()}).next(()=>{t.objectStore(na).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(nm,{keyPath:"name"})})),r<18&&n>=18&&J()&&(s=s.next(()=>{t.objectStore(nr).clear()}).next(()=>{t.objectStore(na).clear()})),s}bi(e){let t=0;return e.store(rR).te((e,r)=>{t+=oe(r)}).next(()=>{let r={byteSize:t};return e.store(rH).put(rW,r)})}wi(e){let t=e.store(rL),r=e.store(rP);return t.J().next(t=>rc.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.J(rV,n).next(r=>rc.forEach(r,r=>{tM(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=aC(this.serializer,r);return a9(e,t.userId,n).next(()=>{})}))}))}Si(e){let t=e.store(rZ),r=e.store(rR);return e.store(r3).get(r6).next(e=>{let n=[];return r.te((r,i)=>{let s=new t3(r),a=[0,rk(s)];n.push(t.get(a).next(r=>r?rc.resolve():t.put({targetId:0,path:rk(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rc.waitFor(n))})}Di(e,t){e.createObjectStore(r5,{keyPath:r4});let r=t.store(r5),n=new a2,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:rk(n)})}};return t.store(rR).te({ee:!0},(e,t)=>i(new t3(e).popLast())).next(()=>t.store(rq).te({ee:!0},([e,t,r],n)=>i(rN(t).popLast())))}Ci(e){let t=e.store(rX);return t.te((e,r)=>{let n=aA(r),i=aD(this.serializer,n);return t.put(i)})}Fi(e,t){let r=t.store(rR),n=[];return r.te((e,r)=>{let i=t.store(rz),s=(r.document?new t8(t3.fromString(r.document.name).popFirst(5)):r.noDocument?t8.fromSegments(r.noDocument.path):r.unknownDocument?t8.fromSegments(r.unknownDocument.path):tR(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>rc.waitFor(n))}Mi(e,t){let r=t.store(rP),n=new og(this.serializer),i=new oN(oO.fi,this.serializer.wt);return r.J().next(e=>{let r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:ss();aC(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),rc.forEach(r,(e,r)=>{let s=new t_(r),a=aL.bt(this.serializer,s),o=i.getIndexManager(s);return new oE(n,ot.bt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new nI(t,rx.le),e).next()})})}}function oP(e){e.createObjectStore(rZ,{keyPath:r0}).createIndex(r1,r2,{unique:!0}),e.createObjectStore(rX,{keyPath:"targetId"}).createIndex(rY,rJ,{unique:!0}),e.createObjectStore(r3)}let oF="IndexedDbPersistence",oV="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",oB="main";class oU{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.xi=i,this.window=s,this.document=a,this.Oi=l,this.Ni=u,this.Bi=h,this.li=null,this.hi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Li=null,this.inForeground=!1,this.ki=null,this.qi=null,this.Qi=-1/0,this.$i=e=>Promise.resolve(),!oU.C())throw new tF(tP.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new od(this,n),this.Ui=t+oB,this.serializer=new aI(o),this.Ki=new rp(this.Ui,this.Bi,new oL(this.serializer)),this.Pi=new aP,this.Ti=new os(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new og(this.serializer),this.Ei=new aM,this.window&&this.window.localStorage?this.Wi=this.window.localStorage:(this.Wi=null,!1===u&&tD(oF,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new tF(tP.FAILED_PRECONDITION,oV);return this.zi(),this.ji(),this.Hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ti.getHighestSequenceNumber(e))}).then(e=>{this.li=new rx(e,this.Oi)}).then(()=>{this.hi=!0}).catch(e=>(this.Ki&&this.Ki.close(),Promise.reject(e)))}Ji(e){return this.$i=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ki.U(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.xi.enqueueAndForget(async()=>{this.started&&await this.Gi()}))}Gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>n_(e,r8).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Yi(e).next(e=>{e||(this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)))})}).next(()=>this.Zi(e)).next(t=>this.isPrimary&&!t?this.Xi(e).next(()=>!1):!!t&&this.es(e).next(()=>!0))).catch(e=>{if(rv(e))return tA(oF,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tA(oF,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.xi.enqueueRetryable(()=>this.$i(e)),this.isPrimary=e})}Yi(e){return n_(e,rO).get(rM).next(e=>rc.resolve(this.ts(e)))}ns(e){return n_(e,r8).delete(this.clientId)}async rs(){if(this.isPrimary&&!this.ss(this.Qi,18e5)){this.Qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=n_(e,r8);return t.J().next(e=>{let r=this._s(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return rc.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Wi)for(let t of e)this.Wi.removeItem(this.us(t.clientId))}}Hi(){this.qi=this.xi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Gi().then(()=>this.rs()).then(()=>this.Hi()))}ts(e){return!!e&&e.ownerId===this.clientId}Zi(e){return this.Ni?rc.resolve(!0):n_(e,rO).get(rM).next(t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new tF(tP.FAILED_PRECONDITION,oV);return!1}}return!(!this.networkEnabled||!this.inForeground)||n_(e,r8).J().next(e=>void 0===this._s(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tA(oF,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.hi=!1,this.ls(),this.qi&&(this.qi.cancel(),this.qi=null),this.hs(),this.Ps(),await this.Ki.runTransaction("shutdown","readwrite",[rO,r8],e=>{let t=new nI(e,rx.le);return this.Xi(t).next(()=>this.ns(t))}),this.Ki.close(),this.Ts()}_s(e,t){return e.filter(e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId))}Is(){return this.runTransaction("getActiveClients","readonly",e=>n_(e,r8).J().next(e=>this._s(e,18e5).map(e=>e.clientId)))}get started(){return this.hi}getGlobalsCache(){return this.Pi}getMutationQueue(e,t){return ot.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new a5(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return aL.bt(this.serializer,e)}getBundleCache(){return this.Ei}runTransaction(e,t,r){var n;let i;tA(oF,"Starting transaction:",e);let s=18===(n=this.Bi)||17===n?nE:16===n||15===n?nb:14===n||13===n?nw:12===n?nv:11===n?ny:void tR(60245);return this.Ki.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new nI(n,this.li?this.li.next():rx.le),"readwrite-primary"===t?this.Yi(i).next(e=>!!e||this.Zi(i)).next(t=>{if(!t)throw tD(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.xi.enqueueRetryable(()=>this.$i(!1)),new tF(tP.FAILED_PRECONDITION,rl);return r(i)}).next(e=>this.es(i).next(()=>e)):this.Es(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Es(e){return n_(e,rO).get(rM).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Ni||this.allowTabSynchronization&&e.allowTabSynchronization))throw new tF(tP.FAILED_PRECONDITION,oV)})}es(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return n_(e,rO).put(rM,t)}static C(){return rp.C()}Xi(e){let t=n_(e,rO);return t.get(rM).next(e=>this.ts(e)?(tA(oF,"Releasing primary lease."),t.delete(rM)):rc.resolve())}ss(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(tD(`Detected an update time that is in the future: ${e} > ${r}`),!1))}zi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ki=()=>{this.xi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Gi()))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground="visible"===this.document.visibilityState)}hs(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)}ji(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Li=()=>{this.ls();let e=/(?:Version|Mobile)\/1[456]/;Y()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.xi.enterRestrictedMode(!0),this.xi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Li))}Ps(){this.Li&&(this.window.removeEventListener("pagehide",this.Li),this.Li=null)}cs(e){var t;try{let r=null!==(null==(t=this.Wi)?void 0:t.getItem(this.us(e)));return tA(oF,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return tD(oF,"Failed to get zombied client id.",e),!1}}ls(){if(this.Wi)try{this.Wi.setItem(this.us(this.clientId),String(Date.now()))}catch(e){tD("Failed to set zombie client id.",e)}}Ts(){if(this.Wi)try{this.Wi.removeItem(this.us(this.clientId))}catch(e){}}us(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oq(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class oz{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.ds=r,this.As=n}static Rs(e,t){let r=ss(),n=ss();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new oz(e,t.fromCache,r,n)}}class oj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class o${constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=Y()?8:rg(z())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.ws(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.bs(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new oj;return this.Ss(e,t,r).next(n=>{if(i.result=n,this.fs)return this.Ds(e,t,r,n.size)})}).next(()=>i.result)}Ds(e,t,r,n){return r.documentReadCount<this.gs?(tx()<=s.DEBUG&&tA("QueryEngine","SDK will not create cache indexes for query:",i6(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),rc.resolve()):(tx()<=s.DEBUG&&tA("QueryEngine","Query:",i6(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ps*n?(tx()<=s.DEBUG&&tA("QueryEngine","The SDK decides to create cache indexes for query:",i6(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,iX(t))):rc.resolve())}ws(e,t){if(iQ(t))return rc.resolve(null);let r=iX(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=iX(t=i0(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=ss(...n);return this.ys.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.vs(t,n);return this.Cs(t,s,i,r.readTime)?this.ws(e,i0(t,null,"F")):this.Fs(e,s,t,r)}))})))}bs(e,t,r,n){return iQ(t)||n.isEqual(t1.min())?rc.resolve(null):this.ys.getDocuments(e,r).next(i=>{let a=this.vs(t,i);return this.Cs(t,a,r,n)?rc.resolve(null):(tx()<=s.DEBUG&&tA("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),i6(t)),this.Fs(e,a,t,ri(n,-1)).next(e=>e))})}vs(e,t){let r=new nN(i4(e));return t.forEach((t,n)=>{i3(e,n)&&(r=r.add(n))}),r}Cs(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Ss(e,t,r){return tx()<=s.DEBUG&&tA("QueryEngine","Using full collection scan to execute query:",i6(t)),this.ys.getDocumentsMatchingQuery(e,t,ra.min(),r)}Fs(e,t,r,n){return this.ys.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let oK="LocalStore";class oG{constructor(e,t,r,n){this.persistence=e,this.Ms=t,this.serializer=n,this.xs=new nA(tX),this.Os=new i8(e=>iB(e),iU),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(r)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oE(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}async function oQ(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=ss();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({ks:e,removedBatchIds:i,addedBatchIds:s}))})})}function oH(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function oW(e,t,r){let n=ss(),i=ss();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=i7;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(t1.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):tA(oK,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{qs:n,Qs:i}})}function oX(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.Ti.getTargetData(r,t).next(i=>i?(n=i,rc.resolve(n)):e.Ti.allocateTargetId(r).next(i=>(n=new aE(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.Ti.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.xs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.xs=e.xs.insert(r.targetId,r),e.Os.set(t,r.targetId)),r})}async function oY(e,t,r){let n=e.xs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!rv(e))throw e;tA(oK,`Failed to update sequence numbers for target ${t}: ${e}`)}e.xs=e.xs.remove(t),e.Os.delete(n.target)}function oJ(e,t,r){let n=t1.min(),i=ss();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=iX(t),void 0!==(o=e.Os.get(a))?rc.resolve(e.xs.get(o)):e.Ti.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.Ti.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Ms.getDocumentsMatchingQuery(s,t,r?n:t1.min(),r?i:ss())).next(r=>(o1(e,i5(t),r),{documents:r,$s:i}))})}function oZ(e,t){let r=e.Ti,n=e.xs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.Rt(e,t).next(e=>e?e.target:null))}function o0(e,t){let r=e.Ns.get(t)||t1.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.Bs.getAllFromCollectionGroup(n,t,ri(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(o1(e,t,r),r))}function o1(e,t,r){let n=e.Ns.get(t)||t1.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ns.set(t,n)}async function o2(e,t,r,n){let i=ss(),s=i7;for(let e of r){let r=t.Us(e.metadata.name);e.document&&(i=i.add(r));let n=t.Ks(e);n.setReadTime(t.Ws(e.metadata.readTime)),s=s.insert(r,n)}let a=e.Bs.newChangeBuffer({trackRemovals:!0}),o=await oX(e,iX(iG(t3.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>oW(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.Ti.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Ti.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.qs,r.Qs)).next(()=>r.qs)))}async function o6(e,t,r=ss()){let n=await oX(e,iX(ak(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=ae(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Ei.saveNamedQuery(i,t);let a=n.withResumeToken(nF.EMPTY_BYTE_STRING,s);return e.xs=e.xs.insert(a.targetId,a),e.Ti.updateTargetData(i,a).next(()=>e.Ti.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.Ti.addMatchingKeys(i,r,n.targetId)).next(()=>e.Ei.saveNamedQuery(i,t))})}let o3="firestore_clients";function o5(e,t){return`${o3}_${e}_${t}`}let o4="firestore_mutations";function o8(e,t,r){let n=`${o4}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let o7="firestore_targets";function o9(e,t){return`${o7}_${e}_${t}`}let le="SharedClientState";class lt{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static Gs(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new tF(n.error.code,n.error.message)),s?new lt(e,t,n.state,i):(tD(le,`Failed to parse mutation state for ID '${t}': ${r}`),null)}zs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Gs(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new tF(r.error.code,r.error.message)),i?new lr(e,r.state,n):(tD(le,`Failed to parse target state for ID '${e}': ${t}`),null)}zs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ln{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Gs(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=sa;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=rD(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new ln(e,i):(tD(le,`Failed to parse client data for instance '${e}': ${t}`),null)}}class li{constructor(e,t){this.clientId=e,this.onlineState=t}static Gs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new li(t.clientId,t.onlineState):(tD(le,`Failed to parse online state: ${e}`),null)}}class ls{constructor(){this.activeTargetIds=sa}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class la{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.xi=t,this.persistenceKey=r,this.Js=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ys=this.Zs.bind(this),this.Xs=new nA(tX),this.started=!1,this.eo=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.no=o5(this.persistenceKey,this.Js),this.ro=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Xs=this.Xs.insert(this.Js,new ls),this.io=RegExp(`^${o3}_${l}_([^_]*)$`),this.so=RegExp(`^${o4}_${l}_(\\d+)(?:_(.*))?$`),this.oo=RegExp(`^${o7}_${l}_(\\d+)$`),this._o=(a=this.persistenceKey,`firestore_online_state_${a}`),this.ao=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.Ys)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Is())){if(e===this.Js)continue;let t=this.getItem(o5(this.persistenceKey,e));if(t){let r=ln.Gs(e,t);r&&(this.Xs=this.Xs.insert(r.clientId,r))}}this.uo();let e=this.storage.getItem(this._o);if(e){let t=this.co(e);t&&this.lo(t)}for(let e of this.eo)this.Zs(e);this.eo=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ro,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ho(this.Xs)}isActiveQueryTarget(e){let t=!1;return this.Xs.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Po(e,"pending")}updateMutationState(e,t,r){this.Po(e,t,r),this.To(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(o9(this.persistenceKey,e));if(t){let n=lr.Gs(e,t);n&&(r=n.state)}}return t&&this.Io.js(e),this.uo(),r}removeLocalQueryTarget(e){this.Io.Hs(e),this.uo()}isLocalQueryTarget(e){return this.Io.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(o9(this.persistenceKey,e))}updateQueryState(e,t,r){this.Eo(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.To(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Ao(e)}notifyBundleLoaded(e){this.Ro(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ys),this.removeItem(this.no),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tA(le,"READ",e,t),t}setItem(e,t){tA(le,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tA(le,"REMOVE",e),this.storage.removeItem(e)}Zs(e){if(e.storageArea===this.storage){if(tA(le,"EVENT",e.key,e.newValue),e.key===this.no)return void tD("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.xi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.io.test(e.key)){if(null==e.newValue){let t=this.Vo(e.key);return this.mo(t,null)}{let t=this.fo(e.key,e.newValue);if(t)return this.mo(t.clientId,t)}}else if(this.so.test(e.key)){if(null!==e.newValue){let t=this.po(e.key,e.newValue);if(t)return this.yo(t)}}else if(this.oo.test(e.key)){if(null!==e.newValue){let t=this.wo(e.key,e.newValue);if(t)return this.bo(t)}}else if(e.key===this._o){if(null!==e.newValue){let t=this.co(e.newValue);if(t)return this.lo(t)}}else if(e.key===this.ro){let t=function(e){let t=rx.le;if(null!=e)try{let r=JSON.parse(e);tM("number"==typeof r,30636,{So:e}),t=r}catch(e){tD(le,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rx.le&&this.sequenceNumberHandler(t)}else if(e.key===this.ao){let t=this.Do(e.newValue);await Promise.all(t.map(e=>this.syncEngine.vo(e)))}}}else this.eo.push(e)})}}get Io(){return this.Xs.get(this.Js)}uo(){this.setItem(this.no,this.Io.zs())}Po(e,t,r){let n=new lt(this.currentUser,e,t,r),i=o8(this.persistenceKey,this.currentUser,e);this.setItem(i,n.zs())}To(e){let t=o8(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ao(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this._o,JSON.stringify(t))}Eo(e,t,r){let n=o9(this.persistenceKey,e),i=new lr(e,t,r);this.setItem(n,i.zs())}Ro(e){let t=JSON.stringify(Array.from(e));this.setItem(this.ao,t)}Vo(e){let t=this.io.exec(e);return t?t[1]:null}fo(e,t){let r=this.Vo(e);return ln.Gs(r,t)}po(e,t){let r=this.so.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return lt.Gs(new t_(i),n,t)}wo(e,t){let r=Number(this.oo.exec(e)[1]);return lr.Gs(r,t)}co(e){return li.Gs(e)}Do(e){return JSON.parse(e)}async yo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);tA(le,`Ignoring mutation for non-active user ${e.user.uid}`)}bo(e){return this.syncEngine.Fo(e.targetId,e.state,e.error)}mo(e,t){let r=t?this.Xs.insert(e,t):this.Xs.remove(e),n=this.ho(this.Xs),i=this.ho(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Mo(s,a).then(()=>{this.Xs=r})}lo(e){this.Xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ho(e){let t=sa;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class lo{constructor(){this.xo=new ls,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,r){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new ls,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ll{No(e){}shutdown(){}}let lu="ConnectivityMonitor";class lh{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){for(let e of(tA(lu,"Network connectivity changed: AVAILABLE"),this.Qo))e(0)}qo(){for(let e of(tA(lu,"Network connectivity changed: UNAVAILABLE"),this.Qo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lc=null;function ld(){return null===lc?lc=0x10000000+Math.round(0x80000000*Math.random()):lc++,"0x"+lc.toString(16)}let lf="RestConnection",lp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lg{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${r}/databases/${n}`,this.Go=this.databaseId.database===nX?`project_id=${r}`:`project_id=${r}&database_id=${n}`}zo(e,t,r,n,i){let s=ld(),a=this.jo(e,t.toUriEncodedString());tA(lf,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(o,n,i);let{host:l}=new URL(a),u=P(l);return this.Jo(e,a,o,r,u).then(t=>(tA(lf,`Received RPC '${e}' ${s}: `,t),t),t=>{throw tk(lf,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}Yo(e,t,r,n,i,s){return this.zo(e,t,r,n,i)}Ho(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+tT,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}jo(e,t){let r=lp[e];return`${this.Ko}/v1/${t}:${r}`}terminate(){}}class lm{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}let ly="WebChannelConnection";class lv extends lg{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,n,i){let s=ld();return new Promise((i,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(h.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();tA(ly,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.TIMEOUT:tA(ly,`RPC '${e}' ${s} timed out`),a(new tF(tP.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let r=o.getStatus();if(tA(ly,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tP).indexOf(e)>=0?e:tP.UNKNOWN);a(new tF(r,t.message))}else a(new tF(tP.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tF(tP.UNAVAILABLE,"Connection failed."));break;default:tR(9055,{h_:e,streamId:s,P_:o.getLastErrorCode(),T_:o.getLastError()})}}finally{tA(ly,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(n);tA(ly,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",u,r,15)})}I_(e,t,r){let n=ld(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=g(),a=p(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Ho(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let h=i.join("");tA(ly,`Creating RPC '${e}' stream ${n}: ${h}`,o);let c=s.createWebChannel(h,o);this.E_(c);let y=!1,v=!1,w=new lm({Zo:t=>{v?tA(ly,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(y||(tA(ly,`Opening RPC '${e}' stream ${n} transport.`),c.open(),y=!0),tA(ly,`RPC '${e}' stream ${n} sending:`,t),c.send(t))},Xo:()=>c.close()}),b=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(c,u.EventType.OPEN,()=>{v||(tA(ly,`RPC '${e}' stream ${n} transport opened.`),w.__())}),b(c,u.EventType.CLOSE,()=>{v||(v=!0,tA(ly,`RPC '${e}' stream ${n} transport closed`),w.u_(),this.d_(c))}),b(c,u.EventType.ERROR,t=>{v||(v=!0,tk(ly,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),w.u_(new tF(tP.UNAVAILABLE,"The operation could not be completed")))}),b(c,u.EventType.MESSAGE,t=>{var r;if(!v){let i=t.data[0];tM(!!i,16349);let s=(null==i?void 0:i.error)||(null==(r=i[0])?void 0:r.error);if(s){tA(ly,`RPC '${e}' stream ${n} received error:`,s);let t=s.status,r=function(e){let t=m[e];if(void 0!==t)return sq(t)}(t),i=s.message;void 0===r&&(r=tP.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),v=!0,w.u_(new tF(r,i)),c.close()}else tA(ly,`RPC '${e}' stream ${n} received:`,i),w.c_(i)}}),b(a,f.STAT_EVENT,t=>{t.stat===d.PROXY?tA(ly,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===d.NOPROXY&&tA(ly,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{w.a_()},0),w}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function lw(){return"undefined"!=typeof window?window:null}function lb(){return"undefined"!=typeof document?document:null}function lE(e){return new s4(e,!0)}class lI{constructor(e,t,r=1e3,n=1.5,i=6e4){this.xi=e,this.timerId=t,this.A_=r,this.R_=n,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();let t=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),n=Math.max(0,t-r);n>0&&tA("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,n,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}let l_="PersistentStream";class lT{constructor(e,t,r,n,i,s,a,o){this.xi=e,this.S_=r,this.D_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new lI(e,t)}O_(){return 1===this.state||5===this.state||this.N_()}N_(){return 2===this.state||3===this.state}start(){this.M_=0,4!==this.state?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&null===this.C_&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,4!==e?this.x_.reset():t&&t.code===tP.RESOURCE_EXHAUSTED?(tD(t.toString()),tD("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===tP.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;let e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.v_===t&&this.z_(e,r)},t=>{e(()=>{let e=new tF(tP.UNKNOWN,"Fetching auth token failed: "+t.message);return this.j_(e)})})}z_(e,t){let r=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(e=>{r(()=>this.j_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.M_?this.J_(e):this.onNext(e))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return tA(l_,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(tA(l_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lS extends lT{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:tR(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tM(void 0===i||"string"==typeof i,58123),nF.fromBase64String(i||"")):(tM(void 0===i||i instanceof E.Buffer||i instanceof Uint8Array,16193),nF.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new sJ(s,a,o,l&&new tF(void 0===l.code?tP.UNKNOWN:sq(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=as(e,n.document.name),s=ae(n.document.updateTime),a=n.document.createTime?ae(n.document.createTime):t1.min(),o=new ig({mapValue:{fields:n.document.fields}}),l=im.newFoundDocument(i,s,a,o);r=new sX(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=as(e,n.document),s=n.readTime?ae(n.readTime):t1.min(),a=im.newNoDocument(i,s);r=new sX([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=as(e,n.document);r=new sX([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tR(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new sB(n,i);r=new sY(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return t1.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?t1.min():t.readTime?ae(t.readTime):t1.min()}(e);return this.listener.Y_(t,r)}Z_(e){let t,r={};r.database=al(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=iq(n)?{documents:ap(e,n)}:{query:ag(e,n).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=s9(e,t.resumeToken);let n=s8(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(t1.min())>0){r.readTime=s7(e,t.snapshotVersion.toTimestamp());let n=s8(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tR(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.Q_(r)}X_(e){let t={};t.database=al(this.serializer),t.removeTarget=e,this.Q_(t)}}class lx extends lT{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return tM(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tM(!e.writeResults||0===e.writeResults.length,55816),this.listener.na()}onNext(e){var t,r;tM(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tM(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?ae(e.updateTime):ae(r)).isEqual(t1.min())&&(t=ae(r)),new sE(t,e.transformResults||[])})):[]),i=ae(e.commitTime);return this.listener.ra(i,n)}ia(){let e={};e.database=al(this.serializer),this.Q_(e)}ta(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ad(this.serializer,e))};this.Q_(t)}}class lC{}class lA extends lC{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.sa=!1}oa(){if(this.sa)throw new tF(tP.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,r,n){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(e,ar(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tP.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tF(tP.UNKNOWN,e.toString())})}Yo(e,t,r,n,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Yo(e,ar(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tP.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tF(tP.UNKNOWN,e.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class lD{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,"Online"===e&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(tD(t),this.ua=!1):tA("OnlineStateTracker",t)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}let lk="RemoteStore";class lN{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(e=>{r.enqueueAndForget(async()=>{lU(this)&&(tA(lk,"Restarting streams for network reachability change."),await async function(e){e.da.add(4),await lO(e),e.Va.set("Unknown"),e.da.delete(4),await lR(e)}(this))})}),this.Va=new lD(r,n)}}async function lR(e){if(lU(e))for(let t of e.Aa)await t(!0)}async function lO(e){for(let t of e.Aa)await t(!1)}function lM(e,t){e.Ea.has(t.targetId)||(e.Ea.set(t.targetId,t),lB(e)?lV(e):l2(e).N_()&&lP(e,t))}function lL(e,t){let r=l2(e);e.Ea.delete(t),r.N_()&&lF(e,t),0===e.Ea.size&&(r.N_()?r.k_():lU(e)&&e.Va.set("Unknown"))}function lP(e,t){if(e.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(t1.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}l2(e).Z_(t)}function lF(e,t){e.ma.Ke(t),l2(e).X_(t)}function lV(e){e.ma=new s0({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Ea.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),l2(e).start(),e.Va.ca()}function lB(e){return lU(e)&&!l2(e).O_()&&e.Ea.size>0}function lU(e){return 0===e.da.size}async function lq(e){e.Va.set("Online")}async function lz(e){e.Ea.forEach((t,r)=>{lP(e,t)})}async function lj(e,t){e.ma=void 0,lB(e)?(e.Va.Pa(t),lV(e)):e.Va.set("Unknown")}async function l$(e,t,r){if(e.Va.set("Online"),t instanceof sJ&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ea.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ea.delete(n),e.ma.removeTarget(n))}(e,t)}catch(r){tA(lk,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await lK(e,r)}else if(t instanceof sX?e.ma.Xe(t):t instanceof sY?e.ma.ot(t):e.ma.nt(t),!r.isEqual(t1.min()))try{let t,n=await oH(e.localStore);r.compareTo(n)>=0&&await ((t=e.ma.It(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ea.get(n);i&&e.Ea.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ea.get(t);if(!n)return;e.Ea.set(t,n.withResumeToken(nF.EMPTY_BYTE_STRING,n.snapshotVersion)),lF(e,t);let i=new aE(n.target,t,r,n.sequenceNumber);lP(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tA(lk,"Failed to raise snapshot:",t),await lK(e,t)}}async function lK(e,t,r){if(!rv(t))throw t;e.da.add(1),await lO(e),e.Va.set("Offline"),r||(r=()=>oH(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tA(lk,"Retrying IndexedDB access"),await r(),e.da.delete(1),await lR(e)})}function lG(e,t){return t().catch(r=>lK(e,r,t))}async function lQ(e){var t;let r=l6(e),n=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:-1;for(;lU(t=e)&&t.Ia.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ia.length&&r.k_();break}n=t.batchId,function(e,t){e.Ia.push(t);let r=l6(e);r.N_()&&r.ea&&r.ta(t.mutations)}(e,t)}catch(t){await lK(e,t)}lH(e)&&lW(e)}function lH(e){return lU(e)&&!l6(e).O_()&&e.Ia.length>0}function lW(e){l6(e).start()}async function lX(e){l6(e).ia()}async function lY(e){let t=l6(e);for(let r of e.Ia)t.ta(r.mutations)}async function lJ(e,t,r){let n=e.Ia.shift(),i=sP.from(n,t,r);await lG(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await lQ(e)}async function lZ(e,t){t&&l6(e).ea&&await async function(e,t){var r;if(sU(r=t.code)&&r!==tP.ABORTED){let r=e.Ia.shift();l6(e).L_(),await lG(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await lQ(e)}}(e,t),lH(e)&&lW(e)}async function l0(e,t){e.asyncQueue.verifyOperationInProgress(),tA(lk,"RemoteStore received new credentials");let r=lU(e);e.da.add(3),await lO(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.da.delete(3),await lR(e)}async function l1(e,t){t?(e.da.delete(2),await lR(e)):t||(e.da.add(2),await lO(e),e.Va.set("Unknown"))}function l2(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={e_:lq.bind(null,e),n_:lz.bind(null,e),i_:lj.bind(null,e),Y_:l$.bind(null,e)},t.oa(),e.fa=new lS(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Aa.push(async t=>{t?(e.fa.L_(),lB(e)?lV(e):e.Va.set("Unknown")):(await e.fa.stop(),e.ma=void 0)})),e.fa}function l6(e){var t,r,n;return e.ga||(t=e.datastore,r=e.asyncQueue,n={e_:()=>Promise.resolve(),n_:lX.bind(null,e),i_:lZ.bind(null,e),na:lY.bind(null,e),ra:lJ.bind(null,e)},t.oa(),e.ga=new lx(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Aa.push(async t=>{t?(e.ga.L_(),await lQ(e)):(await e.ga.stop(),e.Ia.length>0&&(tA(lk,`Stopping write stream with ${e.Ia.length} pending writes`),e.Ia=[]))})),e.ga}class l3{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new tV,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new l3(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tF(tP.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function l5(e,t){if(tD("AsyncQueue",`${t}: ${e}`),rv(e))return new tF(tP.UNAVAILABLE,`${t}: ${e}`);throw e}class l4{static emptySet(e){return new l4(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||t8.comparator(t.key,r.key):(e,t)=>t8.comparator(e.key,t.key),this.keyedMap=se(),this.sortedSet=new nA(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof l4)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new l4;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class l8{constructor(){this.pa=new nA(t8.comparator)}track(e){let t=e.doc.key,r=this.pa.get(t);r?0!==e.type&&3===r.type?this.pa=this.pa.insert(t,e):3===e.type&&1!==r.type?this.pa=this.pa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.pa=this.pa.remove(t):1===e.type&&2===r.type?this.pa=this.pa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):tR(63341,{Vt:e,ya:r}):this.pa=this.pa.insert(t,e)}wa(){let e=[];return this.pa.inorderTraversal((t,r)=>{e.push(r)}),e}}class l7{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new l7(e,t,l4.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&i1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class l9{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class ue{constructor(){this.queries=ut(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new tF(tP.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=ut(),t.forEach((t,r)=>{for(let t of r.Sa)t.onError(e)})}}function ut(){return new i8(e=>i2(e),i1)}async function ur(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Da()&&t.va()&&(r=2):(i=new l9,r=+!t.va());try{switch(r){case 0:i.ba=await e.onListen(n,!0);break;case 1:i.ba=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=l5(r,`Initialization of query '${i6(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Sa.push(t),t.Fa(e.onlineState),i.ba&&t.Ma(i.ba)&&ua(e)}async function un(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=+!t.va():!i.Da()&&t.va()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function ui(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Ma(n)&&(r=!0);i.ba=n}}r&&ua(e)}function us(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.Sa)e.onError(r);e.queries.delete(t)}function ua(e){e.Ca.forEach(e=>{e.next()})}(w=v||(v={})).xa="default",w.Cache="cache";class uo{constructor(e,t,r){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new l7(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){return!(e.fromCache&&this.va())||(!this.options.Qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}La(e){if(e.docChanges.length>0)return!0;let t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qa(e){e=l7.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==v.Cache}}class ul{constructor(e,t){this.$a=e,this.byteLength=t}Ua(){return"metadata"in this.$a}}class uu{constructor(e){this.serializer=e}Us(e){return as(this.serializer,e)}Ks(e){return e.metadata.exists?ac(this.serializer,e.document,!1):im.newNoDocument(this.Us(e.metadata.name),this.Ws(e.metadata.readTime))}Ws(e){return ae(e)}}class uh{constructor(e,t,r){this.Ka=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=uc(e)}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.$a.namedQuery)this.queries.push(e.$a.namedQuery);else if(e.$a.documentMetadata){this.documents.push({metadata:e.$a.documentMetadata}),e.$a.documentMetadata.exists||++t;let r=t3.fromString(e.$a.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.$a.document&&(this.documents[this.documents.length-1].document=e.$a.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new uu(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Us(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||ss()).add(e);t.set(r,n)}}return t}async complete(){let e=await o2(this.localStore,new uu(this.serializer),this.documents,this.Ka.id),t=this.Ga(this.documents);for(let e of this.queries)await o6(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,za:this.collectionGroups,ja:e}}}function uc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ud{constructor(e){this.key=e}}class uf{constructor(e){this.key=e}}class up{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ss(),this.mutatedKeys=ss(),this.Za=i4(e),this.Xa=new l4(this.Za)}get eu(){return this.Ha}tu(e,t){let r=t?t.nu:new l8,n=t?t.Xa:this.Xa,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=i3(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.ru(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.Za(h,o)>0||l&&0>this.Za(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{Xa:s,nu:r,Cs:a,mutatedKeys:i}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;let s=e.nu.wa();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tR(20277,{Vt:e})}})(r)-i(n)||this.Za(e.doc,t.doc)}),this.iu(r),n=null!=n&&n;let a=t&&!n?this.su():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Ja;return(this.Ja=o,0!==s.length||l)?{snapshot:new l7(this.query,e.Xa,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:a}:{ou:a}}Fa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new l8,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}su(){if(!this.current)return[];let e=this.Ya;this.Ya=ss(),this.Xa.forEach(e=>{this._u(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new uf(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new ud(r))}),t}au(e){this.Ha=e.$s,this.Ya=ss();let t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return l7.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,0===this.Ja,this.hasCachedResults)}}let ug="SyncEngine";class um{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class uy{constructor(e){this.key=e,this.cu=!1}}class uv{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.lu={},this.hu=new i8(e=>i2(e),i1),this.Pu=new Map,this.Tu=new Set,this.Iu=new nA(t8.comparator),this.Eu=new Map,this.du=new oS,this.Au={},this.Ru=new Map,this.Vu=oi.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}async function uw(e,t,r=!0){let n,i=uX(e),s=i.hu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.uu()):n=await uE(i,t,r,!0),n}async function ub(e,t){let r=uX(e);await uE(r,t,!0,!1)}async function uE(e,t,r,n){let i,s=await oX(e.localStore,iX(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await uI(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&lM(e.remoteStore,s),i}async function uI(e,t,r,n,i){e.fu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.tu(r);i.Cs&&(i=await oJ(e.localStore,t.query,!1).then(({documents:e})=>t.view.tu(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return uP(e,t.targetId,o.ou),o.snapshot})(e,t,r,n);let s=await oJ(e.localStore,t,!0),a=new up(t,s.$s),o=a.tu(s.documents),l=sW.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);uP(e,r,u.ou);let h=new um(t,r,a);return e.hu.set(t,h),e.Pu.has(r)?e.Pu.get(r).push(t):e.Pu.set(r,[t]),u.snapshot}async function u_(e,t,r){let n=e.hu.get(t),i=e.Pu.get(n.targetId);i.length>1?(e.Pu.set(n.targetId,i.filter(e=>!i1(e,t))),e.hu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await oY(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&lL(e.remoteStore,n.targetId),uM(e,n.targetId)}).catch(rh)):(uM(e,n.targetId),await oY(e.localStore,n.targetId,!0))}async function uT(e,t){let r=e.hu.get(t),n=e.Pu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),lL(e.remoteStore,r.targetId))}async function uS(e,t,r){let n=uY(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=t0.now(),l=t.reduce((e,t)=>e.add(t.key),ss()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=i7,s=ss();return i.Bs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=sc(n.transform,e||null);null!=i&&(null===r&&(r=ig.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new sD(r.key,t,function e(t){let r=[];return nS(t.fields,(t,n)=>{let i=new t4([t]);if(io(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new nM(r)}(t.value.mapValue),sI.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:st(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.Au[n.currentUser.toKey()])||(u=new nA(tX)),u=u.insert(s,r),n.Au[n.currentUser.toKey()]=u,await uV(n,h.changes),await lQ(n.remoteStore)}catch(t){let e=l5(t,"Failed to persist write");r.reject(e)}}async function ux(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.xs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.Bs.newChangeBuffer({trackRemovals:!0});i=r.xs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.Ti.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.Ti.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(nF.EMPTY_BYTE_STRING,t1.min()).withLastLimboFreeSnapshotVersion(t1.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.Ti.updateTargetData(e,h))});let o=i7,l=ss();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(oW(e,s,t.documentUpdates).next(e=>{o=e.qs,l=e.Qs})),!n.isEqual(t1.min())){let t=r.Ti.getLastRemoteSnapshotVersion(e).next(t=>r.Ti.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return rc.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.xs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Eu.get(r);n&&(tM(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.cu=!0:t.modifiedDocuments.size>0?tM(n.cu,14607):t.removedDocuments.size>0&&(tM(n.cu,42227),n.cu=!1))}),await uV(e,s,t)}catch(e){await rh(e)}}function uC(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.hu.forEach((e,r)=>{let n=r.view.Fa(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.Sa)e.Fa(t)&&(r=!0)}),r&&ua(n),i.length&&e.lu.Y_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uA(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Eu.get(t),i=n&&n.key;if(i){let r=new nA(t8.comparator);r=r.insert(i,im.newNoDocument(i,t1.min()));let n=ss().add(i),s=new sH(t1.min(),new Map,new nA(tX),r,n);await ux(e,s),e.Iu=e.Iu.remove(i),e.Eu.delete(t),uF(e)}else await oY(e.localStore,t,!1).then(()=>uM(e,t,r)).catch(rh)}async function uD(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.Bs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=rc.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);tM(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ss();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));uO(e,n,null),uR(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await uV(e,i)}catch(e){await rh(e)}}async function uk(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(tM(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));uO(e,t,r),uR(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await uV(e,i)}catch(e){await rh(e)}}async function uN(e,t){var r;lU(e.remoteStore)||tA(ug,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await (r=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>r.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===n)return void t.resolve();let i=e.Ru.get(n)||[];i.push(t),e.Ru.set(n,i)}catch(r){let e=l5(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function uR(e,t){(e.Ru.get(t)||[]).forEach(e=>{e.resolve()}),e.Ru.delete(t)}function uO(e,t,r){let n=e.Au[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Au[e.currentUser.toKey()]=n}}function uM(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Pu.get(t)))e.hu.delete(n),r&&e.lu.gu(n,r);e.Pu.delete(t),e.isPrimaryClient&&e.du.Hr(t).forEach(t=>{e.du.containsKey(t)||uL(e,t)})}function uL(e,t){e.Tu.delete(t.path.canonicalString());let r=e.Iu.get(t);null!==r&&(lL(e.remoteStore,r),e.Iu=e.Iu.remove(t),e.Eu.delete(r),uF(e))}function uP(e,t,r){for(let n of r)n instanceof ud?(e.du.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Iu.get(r)||e.Tu.has(n)||(tA(ug,"New document in limbo: "+r),e.Tu.add(n),uF(e))}(e,n)):n instanceof uf?(tA(ug,"Document no longer in limbo: "+n.key),e.du.removeReference(n.key,t),e.du.containsKey(n.key)||uL(e,n.key)):tR(19791,{pu:n})}function uF(e){for(;e.Tu.size>0&&e.Iu.size<e.maxConcurrentLimboResolutions;){let t=e.Tu.values().next().value;e.Tu.delete(t);let r=new t8(t3.fromString(t)),n=e.Vu.next();e.Eu.set(n,new uy(r)),e.Iu=e.Iu.insert(r,n),lM(e.remoteStore,new aE(iX(iG(r.path)),n,"TargetPurposeLimboResolution",rx.le))}}async function uV(e,t,r){let n=[],i=[],s=[];e.hu.isEmpty()||(e.hu.forEach((a,o)=>{s.push(e.fu(o,t,r).then(t=>{var s;if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:null==(s=null==r?void 0:r.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=oz.Rs(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.lu.Y_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>rc.forEach(t,t=>rc.forEach(t.ds,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>rc.forEach(t.As,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!rv(e))throw e;tA(oK,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.xs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.xs=e.xs.insert(t,i)}}}(e.localStore,i))}async function uB(e,t){if(!e.currentUser.isEqual(t)){tA(ug,"User change. New user:",t.toKey());let r=await oQ(e.localStore,t);e.currentUser=t,e.Ru.forEach(e=>{e.forEach(e=>{e.reject(new tF(tP.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ru.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await uV(e,r.ks)}}function uU(e,t){let r=e.Eu.get(t);if(r&&r.cu)return ss().add(r.key);{let r=ss(),n=e.Pu.get(t);if(!n)return r;for(let t of n){let n=e.hu.get(t);r=r.unionWith(n.view.eu)}return r}}async function uq(e,t){let r=await oJ(e.localStore,t.query,!0),n=t.view.au(r);return e.isPrimaryClient&&uP(e,t.targetId,n.ou),n}async function uz(e,t){return o0(e.localStore,t).then(t=>uV(e,t))}async function uj(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.tr(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):rc.resolve(null))));null!==o?("pending"===r?await lQ(e.remoteStore):"acknowledged"===r||"rejected"===r?(uO(e,t,n||null),uR(e,t),s=e.localStore,s.mutationQueue.sr(t)):tR(6720,"Unknown batchState",{yu:r}),await uV(e,o)):tA(ug,"Cannot apply mutation batch with id: "+t)}async function u$(e,t){if(uX(e),uY(e),!0===t&&!0!==e.mu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await uK(e,t.toArray());for(let t of(e.mu=!0,await l1(e.remoteStore,!0),r))lM(e.remoteStore,t)}else if(!1===t&&!1!==e.mu){let t=[],r=Promise.resolve();e.Pu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(uM(e,i),oY(e.localStore,i,!0))),lL(e.remoteStore,i)}),await r,await uK(e,t),e.Eu.forEach((t,r)=>{lL(e.remoteStore,r)}),e.du.Jr(),e.Eu=new Map,e.Iu=new nA(t8.comparator),e.mu=!1,await l1(e.remoteStore,!1)}}async function uK(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Pu.get(r);if(s&&0!==s.length)for(let r of(t=await oX(e.localStore,iX(s[0])),s)){let t=e.hu.get(r),n=await uq(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await oZ(e.localStore,r);t=await oX(e.localStore,n),await uI(e,uG(n),r,!1,t.resumeToken)}n.push(t)}return e.lu.Y_(i),n}function uG(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new iK(t,r,n,i,s,"F",e.startAt,e.endAt)}function uQ(e){return e.localStore.persistence.Is()}async function uH(e,t,r,n){if(e.mu)return void tA(ug,"Ignoring unexpected query state notification.");let i=e.Pu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await o0(e.localStore,i5(i[0])),s=sH.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,nF.EMPTY_BYTE_STRING);await uV(e,n,s);break}case"rejected":await oY(e.localStore,t,!0),uM(e,t,n);break;default:tR(64155,r)}}async function uW(e,t,r){let n=uX(e);if(n.mu){for(let e of t){if(n.Pu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tA(ug,"Adding an already active target "+e);continue}let t=await oZ(n.localStore,e),r=await oX(n.localStore,t);await uI(n,uG(t),r.targetId,!1,r.resumeToken),lM(n.remoteStore,r)}for(let e of r)n.Pu.has(e)&&await oY(n.localStore,e,!1).then(()=>{lL(n.remoteStore,e),uM(n,e)}).catch(rh)}}function uX(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=ux.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uA.bind(null,e),e.lu.Y_=ui.bind(null,e.eventManager),e.lu.gu=us.bind(null,e.eventManager),e}function uY(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=uD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uk.bind(null,e),e}class uJ{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lE(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){var t,r;return t=this.persistence,r=new o$,new oG(t,r,e.initialUser,this.serializer)}Su(e){return new oN(oO.fi,this.serializer)}bu(e){return new lo}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}uJ.provider={build:()=>new uJ};class uZ extends uJ{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){return tM(this.persistence.referenceDelegate instanceof oM,46915),new oh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Su(e){let t=void 0!==this.cacheSizeBytes?a7.withCacheSize(this.cacheSizeBytes):a7.DEFAULT;return new oN(e=>oM.fi(e,t),this.serializer)}}class u0 extends uJ{constructor(e,t,r){super(),this.Fu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Fu.initialize(this,e),await uY(this.Fu.syncEngine),await lQ(this.Fu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Du(e){var t,r;return t=this.persistence,r=new o$,new oG(t,r,e.initialUser,this.serializer)}vu(e,t){return new oh(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e,t){let r=new rS(t,this.persistence);return new rT(e.asyncQueue,r)}Su(e){let t=oq(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?a7.withCacheSize(this.cacheSizeBytes):a7.DEFAULT;return new oU(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,lw(),lb(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new lo}}class u1 extends u0{constructor(e,t){super(e,t,!1),this.Fu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Fu.syncEngine;this.sharedClientState instanceof la&&(this.sharedClientState.syncEngine={Co:uj.bind(null,t),Fo:uH.bind(null,t),Mo:uW.bind(null,t),Is:uQ.bind(null,t),vo:uz.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{await u$(this.Fu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}bu(e){let t=lw();if(!la.C(t))throw new tF(tP.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=oq(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new la(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class u2{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uC(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uB.bind(null,this.syncEngine),await l1(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ue}createDatastore(e){var t;let r=lE(e.databaseInfo.databaseId),n=new lv(e.databaseInfo);return t=e.authCredentials,new lA(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new lN(t,r,e.asyncQueue,e=>uC(this.syncEngine,e,0),lh.C()?new lh:new ll)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new uv(r,n,i,s,a,o),t&&(l.mu=!0),l}async terminate(){var e,t;await async function(e){tA(lk,"RemoteStore shutting down."),e.da.add(5),await lO(e),e.Ra.shutdown(),e.Va.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}function u6(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}u2.provider={build:()=>new u2};class u3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):tD("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class u5{constructor(e,t){this.Ou=e,this.serializer=t,this.metadata=new tV,this.buffer=new Uint8Array,this.Nu=new TextDecoder("utf-8"),this.Bu().then(e=>{e&&e.Ua()?this.metadata.resolve(e.$a.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.$a)}`))},e=>this.metadata.reject(e))}close(){return this.Ou.cancel()}async getMetadata(){return this.metadata.promise}async wu(){return await this.getMetadata(),this.Bu()}async Bu(){let e=await this.Lu();if(null===e)return null;let t=this.Nu.decode(e),r=Number(t);return isNaN(r)&&this.ku(`length string (${t}) is not valid number`),new ul(JSON.parse(await this.qu(r)),e.length+r)}Qu(){return this.buffer.findIndex(e=>123===e)}async Lu(){for(;0>this.Qu()&&!await this.$u(););if(0===this.buffer.length)return null;let e=this.Qu();e<0&&this.ku("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async qu(e){for(;this.buffer.length<e;)await this.$u()&&this.ku("Reached the end of bundle when more is expected.");let t=this.Nu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ku(e){throw this.Ou.cancel(),Error(`Invalid bundle format: ${e}`)}async $u(){let e=await this.Ou.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class u4{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new tF(tP.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>ai(e.serializer,t))},n=await e.Yo("BatchGetDocuments",e.serializer.databaseId,t3.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(tM(!!t.found,43571),t.found.name,t.found.updateTime,n=as(r,t.found.name),s=ae(t.found.updateTime),a=t.found.createTime?ae(t.found.createTime):t1.min(),o=new ig({mapValue:{fields:t.found.fields}}),im.newFoundDocument(n,s,a,o)):"missing"in t?(tM(!!t.missing,3894),tM(!!t.readTime,22933),l=as(r,t.missing),u=ae(t.readTime),im.newNoDocument(l,u)):tR(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());tM(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sO(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=t8.fromPath(t);this.mutations.push(new sM(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>ad(e.serializer,t))};await e.zo("Commit",e.serializer.databaseId,t3.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw tR(50498,{Uu:e.constructor.name});t=t1.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new tF(tP.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(t1.min())?sI.exists(!1):sI.updateTime(t):sI.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(t1.min()))throw new tF(tP.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sI.updateTime(t)}return sI.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class u8{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.Ku=r.maxAttempts,this.x_=new lI(this.asyncQueue,"transaction_retry")}Wu(){this.Ku-=1,this.Gu()}Gu(){this.x_.y_(async()=>{let e=new u4(this.datastore),t=this.zu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.ju(e)}))}).catch(e=>{this.ju(e)})})}zu(e){try{let t=this.updateFunction(e);return!rC(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ju(e){this.Ku>0&&this.Hu(e)?(this.Ku-=1,this.asyncQueue.enqueueAndForget(()=>(this.Gu(),Promise.resolve()))):this.deferred.reject(e)}Hu(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sU(t)}return!1}}let u7="FirestoreClient";class u9{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=t_.UNAUTHENTICATED,this.clientId=tW.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tA(u7,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tA(u7,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tV;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=l5(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function he(e,t){e.asyncQueue.verifyOperationInProgress(),tA(u7,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await oQ(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function ht(e,t){e.asyncQueue.verifyOperationInProgress();let r=await hr(e);tA(u7,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>l0(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>l0(t.remoteStore,r)),e._onlineComponents=t}async function hr(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tA(u7,"Using user provided OfflineComponentProvider");try{await he(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tP.FAILED_PRECONDITION||t.code===tP.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tk("Error using user provided cache. Falling back to memory cache: "+t),await he(e,new uJ)}}else tA(u7,"Using default OfflineComponentProvider"),await he(e,new uZ(void 0));return e._offlineComponents}async function hn(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tA(u7,"Using user provided OnlineComponentProvider"),await ht(e,e._uninitializedComponentsProvider._online)):(tA(u7,"Using default OnlineComponentProvider"),await ht(e,new u2))),e._onlineComponents}function hi(e){return hr(e).then(e=>e.persistence)}function hs(e){return hr(e).then(e=>e.localStore)}function ha(e){return hn(e).then(e=>e.remoteStore)}function ho(e){return hn(e).then(e=>e.syncEngine)}function hl(e){return hn(e).then(e=>e.datastore)}async function hu(e){let t=await hn(e),r=t.eventManager;return r.onListen=uw.bind(null,t.syncEngine),r.onUnlisten=u_.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=ub.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=uT.bind(null,t.syncEngine),r}function hh(e,t,r={}){let n=new tV;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await hu(e),s=e.asyncQueue,a=new u3({next:e=>{a.xu(),s.enqueueAndForget(()=>un(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new tF(tP.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new tF(tP.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),ur(i,o=new uo(iG(t.path),a,{includeMetadataChanges:!0,Qa:!0}))}),n.promise}function hc(e,t,r={}){let n=new tV;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await hu(e),s=e.asyncQueue,o=new uo(t,a=new u3({next:e=>{a.xu(),s.enqueueAndForget(()=>un(i,o)),e.fromCache&&"server"===r.source?n.reject(new tF(tP.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Qa:!0}),ur(i,o)}),n.promise}function hd(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hf=new Map;function hp(e,t,r){if(!r)throw new tF(tP.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hg(e,t,r,n){if(!0===t&&!0===n)throw new tF(tP.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function hm(e){if(!t8.isDocumentKey(e))throw new tF(tP.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hy(e){if(t8.isDocumentKey(e))throw new tF(tP.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hv(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":tR(12329,{type:typeof e})}function hw(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tF(tP.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=hv(e);throw new tF(tP.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function hb(e,t){if(t<=0)throw new tF(tP.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let hE="firestore.googleapis.com";class hI{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new tF(tP.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hE,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tF(tP.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hd(null!=(r=e.experimentalLongPollingOptions)?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tF(tP.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tF(tP.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tF(tP.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class h_{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hI({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tF(tP.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tF(tP.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hI(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tU;switch(e.type){case"firstParty":return new t$(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tF(tP.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=hf.get(this))&&(tA("ComponentProvider","Removing Datastore"),hf.delete(this),e.terminate()),Promise.resolve()}}function hT(e,t,r,n={}){var i;e=hw(e,h_);let s=P(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${r}`;s&&(F(`https://${l}`),q("Firestore",!0)),a.host!==hE&&a.host!==l&&tk("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:n});if(!ea(u,o)&&(e._setSettings(u),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=t_.MOCK_USER;else{t=V(n.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new tF(tP.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new t_(s)}e._authCredentials=new tq(new tB(t,r))}}class hS{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new hS(this.firestore,e,this._query)}}class hx{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hx(this.firestore,e,this._key)}}class hC extends hS{constructor(e,t,r){super(e,t,iG(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new hx(this.firestore,null,new t8(e))}withConverter(e){return new hC(this.firestore,e,this._path)}}function hA(e,t,...r){if(e=eg(e),hp("collection","path",t),e instanceof h_){let n=t3.fromString(t,...r);return hy(n),new hC(e,null,n)}{if(!(e instanceof hx||e instanceof hC))throw new tF(tP.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(t3.fromString(t,...r));return hy(n),new hC(e.firestore,null,n)}}function hD(e,t){if(e=hw(e,h_),hp("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new tF(tP.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hS(e,null,new iK(t3.emptyPath(),t))}function hk(e,t,...r){if(e=eg(e),1==arguments.length&&(t=tW.newId()),hp("doc","path",t),e instanceof h_){let n=t3.fromString(t,...r);return hm(n),new hx(e,null,new t8(n))}{if(!(e instanceof hx||e instanceof hC))throw new tF(tP.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(t3.fromString(t,...r));return hm(n),new hx(e.firestore,e instanceof hC?e.converter:null,new t8(n))}}function hN(e,t){return e=eg(e),t=eg(t),(e instanceof hx||e instanceof hC)&&(t instanceof hx||t instanceof hC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function hR(e,t){return e=eg(e),t=eg(t),e instanceof hS&&t instanceof hS&&e.firestore===t.firestore&&i1(e._query,t._query)&&e.converter===t.converter}let hO="AsyncQueue";class hM{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new lI(this,"async_queue_retry"),this.rc=()=>{let e=lb();e&&tA(hO,"Visibility state changed to "+e.visibilityState),this.x_.b_()},this.sc=e;const t=lb();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;let t=lb();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});let t=new tV;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!rv(e))throw e;tA(hO,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){let t=this.sc.then(()=>(this.ec=!0,e().catch(e=>{throw this.Xu=e,this.ec=!1,tD("INTERNAL UNHANDLED ERROR: ",hL(e)),e}).then(e=>(this.ec=!1,e))));return this.sc=t,t}enqueueAfterDelay(e,t,r){this.oc(),this.nc.indexOf(e)>-1&&(t=0);let n=l3.createAndSchedule(this,e,t,r,e=>this.uc(e));return this.Zu.push(n),n}oc(){this.Xu&&tR(47125,{cc:hL(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(let t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{for(let t of(this.Zu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Zu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){let t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function hL(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function hP(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class hF{constructor(){this._progressObserver={},this._taskCompletionResolver=new tV,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class hV extends h_{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new hM,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new hM(e),this._firestoreClient=void 0,await e}}}function hB(e,t,r){r||(r=nX);let n=eZ(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r});if(ea(n.getOptions(r),t))return e;throw new tF(tP.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new tF(tP.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new tF(tP.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&P(t.host)&&F(t.host),n.initialize({options:t,instanceIdentifier:r})}function hU(e,t){let r="object"==typeof e?e:tt(),n="string"==typeof e?e:t||nX,i=eZ(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=R("firestore");e&&hT(i,...e)}return i}function hq(e){if(e._terminated)throw new tF(tP.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||hz(e),e._firestoreClient}function hz(e){var t,r,n,i,s,a;let o,l=e._freezeSettings(),u=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new nW(i,s,e._persistenceKey,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,hd(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator));e._componentsProvider||(null==(r=l.localCache)?void 0:r._offlineComponentProvider)&&(null==(n=l.localCache)?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),e._firestoreClient=new u9(e._authCredentials,e._appCheckCredentials,e._queue,u,e._componentsProvider&&(o=null==(a=e._componentsProvider)?void 0:a._online.build(),{_offline:null==a?void 0:a._offline.build(o),_online:o}))}function hj(e,t){tk("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return hK(e,u2.provider,{build:e=>new u0(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function h$(e){tk("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();hK(e,u2.provider,{build:e=>new u1(e,t.cacheSizeBytes)})}function hK(e,t,r){if((e=hw(e,hV))._firestoreClient||e._terminated)throw new tF(tP.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new tF(tP.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},hz(e)}function hG(e){if(e._initialized&&!e._terminated)throw new tF(tP.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new tV;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rp.C())return Promise.resolve();await rp.delete(e+oB)}(oq(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function hQ(e){var t;let r;return t=hq(e=hw(e,hV)),r=new tV,t.asyncQueue.enqueueAndForget(async()=>uN(await ho(t),r)),r.promise}function hH(e){var t;return(t=hq(e=hw(e,hV))).asyncQueue.enqueue(async()=>{let e=await hi(t),r=await ha(t);return e.setNetworkEnabled(!0),r.da.delete(0),lR(r)})}function hW(e){var t;return(t=hq(e=hw(e,hV))).asyncQueue.enqueue(async()=>{let e=await hi(t),r=await ha(t);return e.setNetworkEnabled(!1),async function(e){e.da.add(0),await lO(e),e.Va.set("Offline")}(r)})}function hX(e){return e0(e.app,"firestore",e._databaseId.database),e._delete()}function hY(e,t){let r=hq(e=hw(e,hV)),n=new hF;return function(e,t,r,n){var i;let s=(i=lE(t),new u5(function(e,t){if(e instanceof Uint8Array)return u6(e,void 0);if(e instanceof ArrayBuffer)return u6(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?tH().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=ae(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ei.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(uc(a));let o=new uh(a,e.localStore,t.serializer),l=await t.wu();for(;l;){let e=await o.Wa(l);e&&r._updateProgress(e),l=await t.wu()}let u=await o.complete();return await uV(e,u.ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Ei.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.za)}catch(e){return tk(ug,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await ho(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}function hJ(e,t){var r;return(r=hq(e=hw(e,hV)),r.asyncQueue.enqueue(async()=>{var e;return e=await hs(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Ei.getNamedQuery(r,t))})).then(t=>t?new hS(e,null,t.query):null)}class hZ{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class h0{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class h1{constructor(e){this._byteString=e}static fromBase64String(e){try{return new h1(nF.fromBase64String(e))}catch(e){throw new tF(tP.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new h1(nF.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class h2{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tF(tP.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new t4(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function h6(){return new h2(t2)}class h3{constructor(e){this._methodName=e}}class h5{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tF(tP.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tF(tP.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tX(this._lat,e._lat)||tX(this._long,e._long)}}class h4{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}}let h8=/^__.*__$/;class h7{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new sD(e,this.data,this.fieldMask,t,this.fieldTransforms):new sA(e,this.data,t,this.fieldTransforms)}}class h9{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new sD(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ce(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tR(40011,{Ic:e})}}class ct{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new ct(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.dc({path:r,Rc:!1});return n.Vc(e),n}mc(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.dc({path:r,Rc:!1});return n.Ec(),n}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return cE(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(0===e.length)throw this.gc("Document fields must not be empty");if(ce(this.Ic)&&h8.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class cr{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||lE(e)}bc(e,t,r,n=!1){return new ct({Ic:e,methodName:t,wc:r,path:t4.emptyPath(),Rc:!1,yc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cn(e){let t=e._freezeSettings(),r=lE(e._databaseId);return new cr(e._databaseId,!!t.ignoreUndefinedProperties,r)}function ci(e,t,r,n,i,s={}){let a,o,l=e.bc(s.merge||s.mergeFields?2:0,t,r,i);cy("Data must be an object, but it was:",l,n);let u=cg(n,l);if(s.merge)a=new nM(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=cv(t,n,r);if(!l.contains(i))throw new tF(tP.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cI(e,i)||e.push(i)}a=new nM(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new h7(new ig(u),a,o)}class cs extends h3{_toFieldTransform(e){if(2!==e.Ic)throw 1===e.Ic?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cs}}function ca(e,t,r){return new ct({Ic:3,wc:t.settings.wc,methodName:e._methodName,Rc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class co extends h3{_toFieldTransform(e){return new sb(e.path,new sd)}isEqual(e){return e instanceof co}}class cl extends h3{constructor(e,t){super(e),this.Sc=t}_toFieldTransform(e){let t=ca(this,e,!0),r=new sf(this.Sc.map(e=>cp(e,t)));return new sb(e.path,r)}isEqual(e){return e instanceof cl&&ea(this.Sc,e.Sc)}}class cu extends h3{constructor(e,t){super(e),this.Sc=t}_toFieldTransform(e){let t=ca(this,e,!0),r=new sg(this.Sc.map(e=>cp(e,t)));return new sb(e.path,r)}isEqual(e){return e instanceof cu&&ea(this.Sc,e.Sc)}}class ch extends h3{constructor(e,t){super(e),this.Dc=t}_toFieldTransform(e){let t=new sy(e.serializer,su(e.serializer,this.Dc));return new sb(e.path,t)}isEqual(e){return e instanceof ch&&this.Dc===e.Dc}}function cc(e,t,r,n){let i=e.bc(1,t,r);cy("Data must be an object, but it was:",i,n);let s=[],a=ig.empty();return nS(n,(e,n)=>{let o=cb(t,e,r);n=eg(n);let l=i.mc(o);if(n instanceof cs)s.push(o);else{let e=cp(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new h9(a,new nM(s),i.fieldTransforms)}function cd(e,t,r,n,i,s){let a=e.bc(1,t,r),o=[cv(t,n,r)],l=[i];if(s.length%2!=0)throw new tF(tP.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(cv(t,s[e])),l.push(s[e+1]);let u=[],h=ig.empty();for(let e=o.length-1;e>=0;--e)if(!cI(u,o[e])){let t=o[e],r=l[e];r=eg(r);let n=a.mc(t);if(r instanceof cs)u.push(t);else{let e=cp(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new h9(h,new nM(u),a.fieldTransforms)}function cf(e,t,r,n=!1){return cp(r,e.bc(n?4:3,t))}function cp(e,t){if(cm(e=eg(e)))return cy("Unsupported field value:",t,e),cg(e,t);if(e instanceof h3)return function(e,t){if(!ce(t.Ic))throw t.gc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.gc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Rc&&4!==t.Ic)throw t.gc("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=cp(i,t.fc(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){if(null===(e=eg(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return su(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=t0.fromDate(e);return{timestampValue:s7(t.serializer,r)}}if(e instanceof t0){let r=new t0(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:s7(t.serializer,r)}}if(e instanceof h5)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof h1)return{bytesValue:s9(t.serializer,e._byteString)};if(e instanceof hx){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.gc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:at(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof h4)return{mapValue:{fields:{[nJ]:{stringValue:n1},[n2]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.gc("VectorValues must only contain numeric values.");return so(t.serializer,e)})}}}}};throw t.gc(`Unsupported field value: ${hv(e)}`)}(e,t)}function cg(e,t){let r={};return nC(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nS(e,(e,n)=>{let i=cp(n,t.Ac(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function cm(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof t0||e instanceof h5||e instanceof h1||e instanceof hx||e instanceof h3||e instanceof h4)}function cy(e,t,r){if(!cm(r)||"object"!=typeof r||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){let n=hv(r);throw"an object"===n?t.gc(e+" a custom object"):t.gc(e+" "+n)}}function cv(e,t,r){if((t=eg(t))instanceof h2)return t._internalPath;if("string"==typeof t)return cb(e,t);throw cE("Field path arguments must be of type string or ",e,!1,void 0,r)}let cw=RegExp("[~\\*/\\[\\]]");function cb(e,t,r){if(t.search(cw)>=0)throw cE(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new h2(...t.split("."))._internalPath}catch(n){throw cE(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function cE(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new tF(tP.INVALID_ARGUMENT,o+e+l)}function cI(e,t){return e.some(e=>e.isEqual(t))}class c_{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hx(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new cT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cT extends c_{data(){return super.data()}}function cS(e,t){return"string"==typeof t?cb(e,t):t instanceof h2?t._internalPath:t._delegate._internalPath}function cx(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tF(tP.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cC{}class cA extends cC{}function cD(e,t,...r){let n=[];for(let i of(t instanceof cC&&n.push(t),function(e){let t=e.filter(e=>e instanceof cR).length,r=e.filter(e=>e instanceof ck).length;if(t>1||t>0&&r>0)throw new tF(tP.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class ck extends cA{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ck(e,t,r)}_apply(e){let t=this._parse(e);return cW(e._query,t),new hS(e.firestore,e.converter,iZ(e._query,t))}_parse(e){let t=cn(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new tF(tP.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){cH(a,s);let t=[];for(let r of a)t.push(cQ(n,e,r));o={arrayValue:{values:t}}}else o=cQ(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||cH(a,s),o=cf(r,t,a,"in"===s||"not-in"===s);return iI.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function cN(e,t,r){let n=cS("where",e);return ck._create(n,t,r)}class cR extends cC{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new cR(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:i_.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())cW(r,e),r=iZ(r,e)}(e._query,t),new hS(e.firestore,e.converter,iZ(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function cO(...e){return e.forEach(e=>cX("or",e)),cR._create("or",e)}function cM(...e){return e.forEach(e=>cX("and",e)),cR._create("and",e)}class cL extends cA{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cL(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new tF(tP.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tF(tP.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ib(t,r)}(e._query,this._field,this._direction);return new hS(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new iK(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function cP(e,t="asc"){let r=cS("orderBy",e);return cL._create(r,t)}class cF extends cA{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new cF(e,t,r)}_apply(e){return new hS(e.firestore,e.converter,i0(e._query,this._limit,this._limitType))}}function cV(e){return hb("limit",e),cF._create("limit",e,"F")}function cB(e){return hb("limitToLast",e),cF._create("limitToLast",e,"L")}class cU extends cA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new cU(e,t,r)}_apply(e){var t;let r=cG(e,this.type,this._docOrFields,this._inclusive);return new hS(e.firestore,e.converter,(t=e._query,new iK(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function cq(...e){return cU._create("startAt",e,!0)}function cz(...e){return cU._create("startAfter",e,!1)}class cj extends cA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new cj(e,t,r)}_apply(e){var t;let r=cG(e,this.type,this._docOrFields,this._inclusive);return new hS(e.firestore,e.converter,(t=e._query,new iK(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function c$(...e){return cj._create("endBefore",e,!1)}function cK(...e){return cj._create("endAt",e,!0)}function cG(e,t,r,n){if(r[0]=eg(r[0]),r[0]instanceof c_)return function(e,t,r,n,i){if(!n)throw new tF(tP.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of iW(e))if(r.field.isKeyField())s.push(it(t,n.key));else{let e=n.data.field(r.field);if(nG(e))throw new tF(tP.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new tF(tP.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new iy(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=cn(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new tF(tP.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new tF(tP.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!iH(e)&&-1!==l.indexOf("/"))throw new tF(tP.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(t3.fromString(l));if(!t8.isDocumentKey(r))throw new tF(tP.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new t8(r);o.push(it(t,i))}else{let e=cf(r,n,l);o.push(e)}}return new iy(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function cQ(e,t,r){if("string"==typeof(r=eg(r))){if(""===r)throw new tF(tP.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iH(t)&&-1!==r.indexOf("/"))throw new tF(tP.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(t3.fromString(r));if(!t8.isDocumentKey(n))throw new tF(tP.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return it(e,new t8(n))}if(r instanceof hx)return it(e,r._key);throw new tF(tP.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hv(r)}.`)}function cH(e,t){if(!Array.isArray(e)||0===e.length)throw new tF(tP.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cW(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new tF(tP.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new tF(tP.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function cX(e,t){if(!(t instanceof ck||t instanceof cR))throw new tF(tP.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class cY{convertValue(e,t="none"){switch(n3(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nU(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nq(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tR(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return nS(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;return new h4(null==(n=null==(r=null==(t=e.fields)?void 0:t[n2].arrayValue)?void 0:r.values)?void 0:n.map(e=>nU(e.doubleValue)))}convertGeoPoint(e){return new h5(nU(e.latitude),nU(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=nQ(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(nH(e));default:return null}}convertTimestamp(e){let t=nB(e);return new t0(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=t3.fromString(e);tM(ab(r),9688,{name:e});let n=new nY(r.get(1),r.get(3)),i=new t8(r.popFirst(5));return n.isEqual(t)||tD(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function cJ(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class cZ extends cY{constructor(e){super(),this.firestore=e}convertBytes(e){return new h1(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hx(this.firestore,null,t)}}function c0(e){return new hZ("sum",cv("sum",e))}function c1(e){return new hZ("avg",cv("average",e))}function c2(){return new hZ("count")}function c6(e,t){var r,n;return e instanceof hZ&&t instanceof hZ&&e.aggregateType===t.aggregateType&&(null==(r=e._internalFieldPath)?void 0:r.canonicalString())===(null==(n=t._internalFieldPath)?void 0:n.canonicalString())}function c3(e,t){return hR(e.query,t.query)&&ea(e.data(),t.data())}class c5{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class c4 extends c_{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new c8(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(cS("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class c8 extends c4{data(e={}){return super.data(e)}}class c7{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new c5(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new c8(this._firestore,this._userDataWriter,r.key,r,new c5(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tF(tP.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new c8(e._firestore,e._userDataWriter,r.doc.key,r.doc,new c5(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new c8(e._firestore,e._userDataWriter,t.doc.key,t.doc,new c5(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tR(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function c9(e,t){return e instanceof c4&&t instanceof c4?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof c7&&t instanceof c7&&e._firestore===t._firestore&&hR(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function de(e){e=hw(e,hx);let t=hw(e.firestore,hV);return hh(hq(t),e._key).then(r=>dg(t,e,r))}class dt extends cY{constructor(e){super(),this.firestore=e}convertBytes(e){return new h1(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hx(this.firestore,null,t)}}function dr(e){var t;let r;e=hw(e,hx);let n=hw(e.firestore,hV),i=hq(n),s=new dt(n);return(t=e._key,r=new tV,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new tF(tP.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=l5(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await hs(i),t,r)),r.promise).then(t=>new c4(n,s,e._key,t,new c5(null!==t&&t.hasLocalMutations,!0),e.converter))}function dn(e){e=hw(e,hx);let t=hw(e.firestore,hV);return hh(hq(t),e._key,{source:"server"}).then(r=>dg(t,e,r))}function di(e){e=hw(e,hS);let t=hw(e.firestore,hV),r=hq(t),n=new dt(t);return cx(e._query),hc(r,e._query).then(r=>new c7(t,n,e,r))}function ds(e){var t;let r;e=hw(e,hS);let n=hw(e.firestore,hV),i=hq(n),s=new dt(n);return(t=e._query,r=new tV,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await oJ(e,t,!0),i=new up(t,n.$s),s=i.tu(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=l5(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await hs(i),t,r)),r.promise).then(t=>new c7(n,s,e,t))}function da(e){e=hw(e,hS);let t=hw(e.firestore,hV),r=hq(t),n=new dt(t);return hc(r,e._query,{source:"server"}).then(r=>new c7(t,n,e,r))}function dl(e,t,r){e=hw(e,hx);let n=hw(e.firestore,hV),i=cJ(e.converter,t,r);return dp(n,[ci(cn(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,sI.none())])}function du(e,t,r,...n){e=hw(e,hx);let i=hw(e.firestore,hV),s=cn(i);return dp(i,[("string"==typeof(t=eg(t))||t instanceof h2?cd(s,"updateDoc",e._key,t,r,n):cc(s,"updateDoc",e._key,t)).toMutation(e._key,sI.exists(!0))])}function dh(e){return dp(hw(e.firestore,hV),[new sO(e._key,sI.none())])}function dc(e,t){let r=hw(e.firestore,hV),n=hk(e),i=cJ(e.converter,t);return dp(r,[ci(cn(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,sI.exists(!1))]).then(()=>n)}function dd(e,...t){var r,n,i,s;let a,o,l,u,h;e=eg(e);let c={includeMetadataChanges:!1,source:"default"},d=0;"object"!=typeof t[0]||hP(t[d])||(c=t[d],d++);let f={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(hP(t[d])){let e=t[d];t[d]=null==(r=e.next)?void 0:r.bind(e),t[d+1]=null==(n=e.error)?void 0:n.bind(e),t[d+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof hx)o=hw(e.firestore,hV),l=iG(e._key.path),a={next:r=>{t[d]&&t[d](dg(o,e,r))},error:t[d+1],complete:t[d+2]};else{let r=hw(e,hS);o=hw(r.firestore,hV),l=r._query;let n=new dt(o);a={next:e=>{t[d]&&t[d](new c7(o,n,r,e))},error:t[d+1],complete:t[d+2]},cx(e._query)}return s=hq(o),h=new uo(l,u=new u3(a),f),s.asyncQueue.enqueueAndForget(async()=>ur(await hu(s),h)),()=>{u.xu(),s.asyncQueue.enqueueAndForget(async()=>un(await hu(s),h))}}function df(e,t){var r;let n;return r=hq(e=hw(e,hV)),n=new u3(hP(t)?t:{next:t}),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hu(r),void(e.Ca.add(n),n.next())}),()=>{n.xu(),r.asyncQueue.enqueueAndForget(async()=>{var e;return e=await hu(r),void e.Ca.delete(n)})}}function dp(e,t){var r;let n;return r=hq(e),n=new tV,r.asyncQueue.enqueueAndForget(async()=>uS(await ho(r),t,n)),n.promise}function dg(e,t,r){let n=r.docs.get(t._key),i=new dt(e);return new c4(e,i,t._key,n,new c5(r.hasPendingWrites,r.fromCache),t.converter)}function dm(e){return dy(e,{count:c2()})}function dy(e,t){var r;let n,i=hw(e.firestore,hV),s=hq(i),a=nx(t,(e,t)=>new sV(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new tV,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await hl(s);n.resolve(async function(e,t,r){var n;let{request:i,yt:s,parent:a}=am(e.serializer,iY(t),r);e.connection.Uo||delete i.parent;let o=(await e.Yo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);tM(1===o.length,64727);let l=null==(n=o[0].result)?void 0:n.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new h0(e,new dt(i),t))}class dv{constructor(e){this.kind="memory",this._onlineComponentProvider=u2.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new uZ(void 0)}}toJSON(){return{kind:this.kind}}}class dw{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=dA(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class db{constructor(){this.kind="memoryEager",this._offlineComponentProvider=uJ.provider}toJSON(){return{kind:this.kind}}}class dE{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new uZ(e)}}toJSON(){return{kind:this.kind}}}function dI(){return new db}function d_(e){return new dE(null==e?void 0:e.cacheSizeBytes)}function dT(e){return new dv(e)}function dS(e){return new dw(e)}class dx{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=u2.provider,this._offlineComponentProvider={build:t=>new u0(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class dC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=u2.provider,this._offlineComponentProvider={build:t=>new u1(t,null==e?void 0:e.cacheSizeBytes)}}}function dA(e){return new dx(null==e?void 0:e.forceOwnership)}function dD(){return new dC}let dk={maxAttempts:5};class dN{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cn(e)}set(e,t,r){this._verifyNotCommitted();let n=dR(e,this._firestore),i=cJ(n.converter,t,r),s=ci(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,sI.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=dR(e,this._firestore);return i="string"==typeof(t=eg(t))||t instanceof h2?cd(this._dataReader,"WriteBatch.update",s._key,t,r,n):cc(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,sI.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=dR(e,this._firestore);return this._mutations=this._mutations.concat(new sO(t._key,sI.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new tF(tP.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function dR(e,t){if((e=eg(e)).firestore!==t)throw new tF(tP.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class dO{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cn(e)}get(e){let t=dR(e,this._firestore),r=new cZ(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tR(24041);let n=e[0];if(n.isFoundDocument())return new c_(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new c_(this._firestore,r,t._key,null,t.converter);throw tR(18433,{doc:n})})}set(e,t,r){let n=dR(e,this._firestore),i=cJ(n.converter,t,r),s=ci(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=dR(e,this._firestore);return i="string"==typeof(t=eg(t))||t instanceof h2?cd(this._dataReader,"Transaction.update",s._key,t,r,n):cc(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=dR(e,this._firestore);return this._transaction.delete(t._key),this}}class dM extends dO{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=dR(e,this._firestore),r=new dt(this._firestore);return super.get(e).then(e=>new c4(this._firestore,r,t._key,e._document,new c5(!1,!1),t.converter))}}function dL(e,t,r){var n,i;let s;e=hw(e,hV);let a=Object.assign(Object.assign({},dk),r);if(a.maxAttempts<1)throw new tF(tP.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=hq(e),i=r=>t(new dM(e,r)),s=new tV,n.asyncQueue.enqueueAndForget(async()=>{let e=await hl(n);new u8(n.asyncQueue,e,a,i,s).Wu()}),s.promise}function dP(){return new cs("deleteField")}function dF(){return new co("serverTimestamp")}function dV(...e){return new cl("arrayUnion",e)}function dB(...e){return new cu("arrayRemove",e)}function dU(e){return new ch("increment",e)}function dq(e){return new h4(e)}function dz(e){return hq(e=hw(e,hV)),new dN(e,t=>dp(e,t))}function dj(e,t){let r=hq(e=hw(e,hV));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return tk("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new tF(tP.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=d$(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=cb("setIndexConfiguration",d$(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new rr(e,2)):"ASCENDING"===t.order?n.push(new rr(e,0)):"DESCENDING"===t.order&&n.push(new rr(e,1))}r.push(new t7(t7.UNKNOWN_ID,t,n,rn.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,rt,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>rc.waitFor(n)))})(await hs(r),n))}function d$(e,t){if("string"!=typeof e[t])throw new tF(tP.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class dK{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function dG(e){var t;e=hw(e,hV);let r=dY.get(e);if(r)return r;if("persistent"!==(null==(t=hq(e)._uninitializedComponentsProvider)?void 0:t._offline.kind))return null;let n=new dK(e);return dY.set(e,n),n}function dQ(e){dX(e,!0)}function dH(e){dX(e,!1)}function dW(e){var t;(t=hq(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await hs(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>tA("deleting all persistent cache indexes succeeded")).catch(e=>tk("deleting all persistent cache indexes failed",e))}function dX(e,t){var r;(r=hq(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await hs(r),void(e.Ms.fs=t)})).then(e=>tA(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>tk(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let dY=new WeakMap;function dJ(e){var t;let r=null==(t=hq(hw(e.firestore,hV))._onlineComponents)?void 0:t.datastore.serializer;return void 0===r?null:ag(r,iX(e._query)).gt}function dZ(e,t){var r;let n=nx(t,(e,t)=>new sV(t,e.aggregateType,e._internalFieldPath)),i=null==(r=hq(hw(e.firestore,hV))._onlineComponents)?void 0:r.datastore.serializer;return void 0===i?null:am(i,iY(e._query),n,!0).request}class d0{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return d1.instance.onExistenceFilterMismatch(e)}}class d1{constructor(){this.vc=new Map}static get instance(){return d2||function(e){if(sz)throw Error("a TestingHooksSpi instance is already set");sz=e}(d2=new d1),d2}ht(e){this.vc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.vc;return r.set(t,e),()=>r.delete(t)}}let d2=null;!function(e=!0){tT=e7,eJ(new em("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new hV(new tz(t.getProvider("auth-internal")),new tG(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tF(tP.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nY(e.options.projectId,t)}(i,r),i);return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),ti(tE,tI,void 0),ti(tE,tI,"esm2017")}(),e.s(["AbstractUserDataWriter",()=>cY,"AggregateField",()=>hZ,"AggregateQuerySnapshot",()=>h0,"Bytes",()=>h1,"CACHE_SIZE_UNLIMITED",()=>-1,"CollectionReference",()=>hC,"DocumentReference",()=>hx,"DocumentSnapshot",()=>c4,"FieldPath",()=>h2,"FieldValue",()=>h3,"Firestore",()=>hV,"FirestoreError",()=>tF,"GeoPoint",()=>h5,"LoadBundleTask",()=>hF,"PersistentCacheIndexManager",()=>dK,"Query",()=>hS,"QueryCompositeFilterConstraint",()=>cR,"QueryConstraint",()=>cA,"QueryDocumentSnapshot",()=>c8,"QueryEndAtConstraint",()=>cj,"QueryFieldFilterConstraint",()=>ck,"QueryLimitConstraint",()=>cF,"QueryOrderByConstraint",()=>cL,"QuerySnapshot",()=>c7,"QueryStartAtConstraint",()=>cU,"SnapshotMetadata",()=>c5,"Timestamp",()=>t0,"Transaction",()=>dM,"VectorValue",()=>h4,"WriteBatch",()=>dN,"_AutoId",()=>tW,"_ByteString",()=>nF,"_DatabaseId",()=>nY,"_DocumentKey",()=>t8,"_EmptyAppCheckTokenProvider",()=>tQ,"_EmptyAuthCredentialsProvider",()=>tU,"_FieldPath",()=>t4,"_TestingHooks",()=>d0,"_cast",()=>hw,"_debugAssert",()=>tL,"_internalAggregationQueryToProtoRunAggregationQueryRequest",()=>dZ,"_internalQueryToProtoQueryTarget",()=>dJ,"_isBase64Available",()=>nP,"_logWarn",()=>tk,"_validateIsNotUsedTogether",()=>hg,"addDoc",()=>dc,"aggregateFieldEqual",()=>c6,"aggregateQuerySnapshotEqual",()=>c3,"and",()=>cM,"arrayRemove",()=>dB,"arrayUnion",()=>dV,"average",()=>c1,"clearIndexedDbPersistence",()=>hG,"collection",()=>hA,"collectionGroup",()=>hD,"connectFirestoreEmulator",()=>hT,"count",()=>c2,"deleteAllPersistentCacheIndexes",()=>dW,"deleteDoc",()=>dh,"deleteField",()=>dP,"disableNetwork",()=>hW,"disablePersistentCacheIndexAutoCreation",()=>dH,"doc",()=>hk,"documentId",()=>h6,"enableIndexedDbPersistence",()=>hj,"enableMultiTabIndexedDbPersistence",()=>h$,"enableNetwork",()=>hH,"enablePersistentCacheIndexAutoCreation",()=>dQ,"endAt",()=>cK,"endBefore",()=>c$,"ensureFirestoreConfigured",()=>hq,"executeWrite",()=>dp,"getAggregateFromServer",()=>dy,"getCountFromServer",()=>dm,"getDoc",()=>de,"getDocFromCache",()=>dr,"getDocFromServer",()=>dn,"getDocs",()=>di,"getDocsFromCache",()=>ds,"getDocsFromServer",()=>da,"getFirestore",()=>hU,"getPersistentCacheIndexManager",()=>dG,"increment",()=>dU,"initializeFirestore",()=>hB,"limit",()=>cV,"limitToLast",()=>cB,"loadBundle",()=>hY,"memoryEagerGarbageCollector",()=>dI,"memoryLocalCache",()=>dT,"memoryLruGarbageCollector",()=>d_,"namedQuery",()=>hJ,"onSnapshot",()=>dd,"onSnapshotsInSync",()=>df,"or",()=>cO,"orderBy",()=>cP,"persistentLocalCache",()=>dS,"persistentMultipleTabManager",()=>dD,"persistentSingleTabManager",()=>dA,"query",()=>cD,"queryEqual",()=>hR,"refEqual",()=>hN,"runTransaction",()=>dL,"serverTimestamp",()=>dF,"setDoc",()=>dl,"setIndexConfiguration",()=>dj,"setLogLevel",()=>tC,"snapshotEqual",()=>c9,"startAfter",()=>cz,"startAt",()=>cq,"sum",()=>c0,"terminate",()=>hX,"updateDoc",()=>du,"vector",()=>dq,"waitForPendingWrites",()=>hQ,"where",()=>cN,"writeBatch",()=>dz],17875),e.s([],36180)}]);